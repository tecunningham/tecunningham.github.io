{
  "hash": "29508864c90a9cfc72c9e9a8a4ee9f88",
  "result": {
    "markdown": "---\ntitle: Runner Percentile Calculation\nauthor: Tom Cunningham\ndate: 2023-08-11\ndraft: true\nexecute:\n  echo: false\n  cache: true # caches chunk output\nfig-align: center\nreference-location: margin\nformat:\n   html:\n      toc: true\n      toc-depth: 2\n      toc-location: left\n      code-fold: true\n      html-math-method:\n         method: mathjax\n         url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js\"\n         #     ^ this forces SVG instead of CHTML, otherwise xypic renders weird\n      include-in-header:\n         - text: |\n            <script>window.MathJax = {\n                     loader: { load: ['[custom]/xypic.js'],\n                                 paths: {custom: 'https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/'}},\n                  tex: {packages: {'[+]': ['xypic']},\n                     macros: {\n                        bm: [\"\\\\boldsymbol{#1}\", 1],\n                        ut: [\"\\\\underbrace{#1}_{\\\\text{#2}}\", 2],\n                        utt: [\"\\\\underbrace{#1}_{\\\\substack{\\\\text{#2}\\\\\\\\\\\\text{#3}}}\", 3]\n                     }}};\n            </script>\n\nengine: knitr\neditor:\n   render-on-save: true\n---\n\n<style>\n   h1 {  border-bottom: 4px solid black;}\n   h2 {  border-bottom: 1px solid gray; padding-bottom: 0px; font-size: 14px; color: black; }\n   dl {display: grid;grid-template-columns: max-content auto;}\n   dt {grid-column-start: 1;}\n   dd {grid-column-start: 2; margin-left: 2em;}\n</style>\n\n- **Suppose you pass 100 times as many runners as pass you.**\n- **Then there are only 10 times as many runners who you are faster than, than runners who are faster than you.**\n\n- You're less likely to pass, or be passed by, a runner whose speed is close to yours. So if you're faster than 90% of runners you pass (or are passed by) this doesn't imply you're faster than 90% of all runners.\n- If we assume the distribution is normal.\n\n#          Uniform Distribution of Speeds\n\nWith a uniform distribution you can easily see that the number of passings is proportional to the area of the triangle, and so proportional to the *square* of the number of runners below/above your speed.\n\n\n::: {.cell hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-1_952d91abb570367f918b6818066588e6'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n#          Normal Distribution of Speeds\n\n\n::: {.cell .column-margin hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-2_03ddf149a1bb2dea797b07e601f29641'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell .column-margin hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-3_d500f10e7ad4c4cb290380fcfb368349'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell .column-margin hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-4_91c13ed99fa1c2f654bac2f8e54e5813'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell .column-margin hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-5_f02d49a7ad3257653af367e666a43eb7'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n<!-- ```{tikz}\n#| column: margin\n\\pgfmathdeclarefunction{gauss}{3}{\\pgfmathparse{1/(#3*sqrt(2*pi))*exp(-((#1-#2)^2)/(2*#3^2))}}\n\\tikzset{declare function={normcdf(\\x,\\m,\\s)=1/(1 + exp(-0.07056*((\\x-\\m)/\\s)^3 - 1.5976*(\\x-\\m)/\\s));}}\n\\begin{tikzpicture}\n   \\draw[<->] (-2,2) -- (-2,0) node[rotate=90,midway,above,align=center]{ratio}-- (2,0) node[midway,below] {my speed};\n   \\draw[domain=-2:2] (-2,0) -- plot({\\x},{(gauss(\\x,0,1)+\\x*normcdf(\\x,0,1))/(2*gauss(\\x,0,1)+\\x*normcdf(\\x,0,1)-\\x)}) -- (2,0);\n   \\draw[domain=-2:2,red] (-2,0) -- plot({\\x},{(normcdf(\\x,0,1))/(1-normcdf(\\x,0,1))}) -- (2,0);\n   \\draw[dashed] (0,0)--(0,1);\n   \\node at (0,2) {ratio};\n\\end{tikzpicture}\n``` -->\n\n::: {.cell hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-6_8ed5226d8a871a158e53fb079fb300f1'}\n::: {.cell-output-display}\n![](2023-08-13-runner-percentile_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n$$\\begin{aligned}\n   s &= \\text{my speed} \\\\\n   x &\\sim \\phi, \\text{other runners' speeds} \\\\\n   \\text{runners I pass}\n      &= \\int_{-\\infty}^s \\utt{\\phi(x)}{runners w}{speed $x$}\\utt{(s-x)}{prob I}{pass them}dx\\\\\n      &= s\\Phi(s) - \\int_{-\\infty}^s x\\phi(x) dx \\\\\n      &= s \\Phi(s) + \\phi(s) \\\\\n      & \\text{(last step uses $\\phi=N(0,1)$)}\\\\\n   \\text{runners who pass me}\n      &= \\int_{s}^\\infty \\utt{\\phi(x)}{runners w}{speed $x$}\\utt{(x-s)}{prob they}{pass me}dx\\\\\n      &= \\left[  -\\phi(x) -s\\Phi(x)  \\right]^\\infty_s \\\\\n      &= (0+\\phi(s)) - (s-s\\Phi(s))\\\\\n      &= \\phi(s) - s + s\\Phi(s) \\\\\n   \\text{share I pass}\n      &= \\frac{s \\Phi(s) + \\phi(s)}{s \\Phi(s) + \\phi(s)+\\phi(s) - s + s\\Phi(s)} \\\\\n      &= \\frac{s \\Phi(s) + \\phi(s)}{2s\\Phi(s) + 2\\phi(s) - s}\n\\end{aligned}$$\n\n**Note on derivatives:**\n\n\n$$\\begin{aligned}\n   \\phi(x) &= \\frac{1}{\\sqrt{2\\pi}}e^{-x^2/2}\n      && \\text{(standard normal)}\\\\\n   \\phi'(x) &= -x\\phi(x)\n\\end{aligned}$$\n\n\n::: {.cell hash='2023-08-13-runner-percentile_cache/html/unnamed-chunk-7_9113874ce374f39405746f249faafa94'}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.55388\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9.330527\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.7791446\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6914625\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 237.8047\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 8.559642\n```\n:::\n:::\n\n| std deviation | ratio speeds | ratio passes (gauss) | ratio passes (uniform) | ratio passes (t,df=1) |\n| ------------- | ------------ | -------------------- | ---------------------- | --------------------- |\n| 0             | 1            | 1                    | 1                      | 1                     |\n| .5            | 2.2          | 3.5                  | 5                      | 1.9                   |\n| .7            | 3.1          | 5.9                  | 9.6                    |                       |\n| .9            | 4.4          | 10                   | 19                     |                       |\n| 1             | 5.3          | 13                   | 28                     | 3.3                   |\n| 1.3           | 9.3          | 30                   | 86                     |                       |\n| 2             | 43           | 238                  | 1849                   | 8.5                   |\n\n\n\nâˆ‘#                 Post\n\nSuppose you go for a run and you pass 90% of people you see (the other 10% of people pass you). What's your overall rank in the distribution of speeds?\n\nWe can't know for sure but if you assume the distribution of speeds is Normal then you're at approximately 80% (i.e. 80% of runners are slower, 20% are faster). The asymmetry is because you're relatively less likely to pass (or be passed by) people who run at a similar speed as you.\n\nIf you .\n\n#           R simulation\n\n```\npass <- function(x) {\n   x * pnorm(x) + 2 * dnorm(x)\n}\npassed <- function(x) {\n   x * pnorm(x) + 2 * dnorm(x) - x\n}\nshare <- function(x) {\n   pass(x) / (pass(x) + passed(x))\n}\n\n\n\nx <- 0\ndensity <- dnorm\n\npass_sum(0, function(x) {\n   dt(x, df = 1)\n})\npass_sum(0, function(x) {\n   dt(x, df = 5)\n})\n\n\npassed_sum <- function(x) {\n   integral <- 0\n   for (speed in seq(x, 10, 0.1)) {\n      integral <- integral + dnorm(speed) * (speed - x) * 0.1\n   }\n   return(integral)\n}\nshare_sum <- function(x) {\n   pass_sum(x) / (pass_sum(x) + passed_sum(x))\n}\n\npass(0)\npass_sum(0)\n\npassed(.5)\n\nshare(.5)\npnorm(.5)\nshare_sum(.5)\n\n```\n -->\n#           References\n\nMathoverflow [\"You pass X people and Y people pass you: how relatively fast are you?\"](https://mathoverflow.net/questions/40913/you-pass-x-people-and-y-people-pass-you-how-relatively-fast-are-you)\n   There are a number of sketches of answers but no explicit solutions. A few answers wrongly conclude that the ratio of overtakes/overtakens is equal to the ratio of faster/slower runners.\n\nClevenson, Schilling, Watkins and Watkins (2001) \"The Average Speed on the Highway\" -- they show that if you're passed by an equal number of cars that pass you, then you're driving the average speed (not necessarily the median speed).\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Cunningham">
<meta name="description" content="Tom Cunningham blog">

<title>AI and the Offense-Defense Balance | Tom Cunningham – Tom Cunningham</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d5e7c60e6424aa6ccf163f01508596ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-12027453-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script>window.MathJax = {
   loader: { load: ["https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/xypic.js"]},
   tex: {packages: {'[+]': ['xypic','bm']},
         macros: {  bm: ["\\boldsymbol{#1}", 1],
                    ut: ["\\underbrace{#1}_{\\text{#2}}", 2],
                    utt: ["\\underbrace{#1}_{\\substack{\\text{#2}\\\\\\text{#3}}}", 3] }
   }
};
</script>
<style>
   h1 {  border-bottom: 8px solid #557;}
   h2 {  border-bottom: 1px solid #ccc;}
   .greyproof {
      background-color: #f5f5f5;
      padding: 1em;
      margin: 1em 0;
      border-radius: 4px;
   }
</style>
<script>window.MathJax = {
         loader: { load: ['[custom]/xypic.js'],
                     paths: {custom: 'https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/'}},
      tex: {packages: {'[+]': ['xypic']},
         macros: {
            bm: ["\\boldsymbol{#1}", 1],
            ut: ["\\underbrace{#1}_{\\text{#2}}", 2],
            utt: ["\\underbrace{#1}_{\\substack{\\text{#2}\\\\\\text{#3}}}", 3]
         }}};
</script>
<style>
   h1 {  border-bottom: 4px solid black; }
   h2 {  border-bottom: 1px solid gray; padding-bottom: 0px; color: black; }
   dl {display: grid;grid-template-columns: max-content auto;}
   dt {grid-column-start: 1; width: 4cm;}
   dd {grid-column-start: 2; margin-left: 2em;}
</style>
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="AI and the Offense-Defense Balance | Tom Cunningham">
<meta name="twitter:description" content="Tom Cunningham blog">
<meta name="twitter:image" content="tecunningham.github.io/posts/2025-03-01-offense-defense-balance_files/figure-html/unnamed-chunk-1-1.png">
<meta name="twitter:image-height" content="642">
<meta name="twitter:image-width" content="700">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tom Cunningham</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href=".././about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/testingham"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tom-cunningham-a9433/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://tecunningham.github.io/index.xml"> <i class="bi bi-rss-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=MDB_DgkAAAAJ"> 
<span class="menu-text">scholar</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">AI and the Offense-Defense Balance</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>==TO DO: draw isovalue curves for various parameters==</p>
<dl>
<dt>AI will change the balance of power across <em>dozens</em> of different areas.</dt>
<dd>
<p>AI is already being adopted by both sides in teaching, hiring, war, education, publication, communication.</p>
<p>In some cases it will shift things in favor of the offense, in some it will shift in favor of defense.</p>
<p>I describe four stylized models of the offense-defense balance.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Offense</th>
<th>Defense</th>
<th>AI favors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>finding holes</td>
<td>plugging holes</td>
<td>defense</td>
</tr>
<tr class="even">
<td>finding holes</td>
<td>watching holes</td>
<td>offense</td>
</tr>
<tr class="odd">
<td>forging items</td>
<td>verifying items</td>
<td>defense</td>
</tr>
<tr class="even">
<td>forging items</td>
<td>examining items</td>
<td>offense</td>
</tr>
</tbody>
</table>
</dd>
<dt>The theory will be very loose.</dt>
<dd>
By the standards of economic theory published in journals this blog post is going to be enormously loose. But it feels like a sufficiently important question that it’s worth taking a picture even if it’s blurry.
</dd>
<dt>Offense as finding holes.</dt>
<dd>
<p>Suppose offense and defense are both exerting effort to find <em>holes</em>. If offense finds a hole that’s not defended, then it wins the game. Two subgames:</p>
<ul>
<li><p><strong>Defense plugs holes.</strong> When defense finds a hole then it can fix it, putting a plug in it. If offense finds a hole, and it’s not fixed, then it wins a point. If AI makes it easier for both sides to find holes, and assuming the return to effort on finding holes is decreasing, this will favor the defender, because we eventually run out of holes.</p></li>
<li><p><strong>Defense watches holes.</strong> When defense finds a hold then it can <em>watch</em> that hole, but they have limited attention. Now if both sides get better at finding holes the advantage will be to the attacker (assuming the defender has diminishing ability to watch more holes).</p></li>
</ul>
</dd>
<dt>Offense as forging items.</dt>
<dd>
<p>Suppose offense chooses some X and the defender examines it to see if it’s genuine. Both sides have access to a classifier that can give an imperfect signal of whether X is genuine.</p>
<ul>
<li><p><strong>Defense verifies items.</strong> Suppose defense can freely verify the quality of the item. As the classifier gets better this will tend to favor the defense because we know a perfect classifier must perfectly favor the defense.</p></li>
<li><p><strong>Defense examines items.</strong> The offense chooses some X and the defender examines it to see whether it <em>appears</em> genuine. In this case the appearance of X isn’t the ground truth, the property depends on some external fact about the world. In this case a perfect classifier helps the offense because they can then pass their forgeries off perfectly.</p></li>
</ul>
</dd>
</dl>
<section id="applications" class="level2">
<h2 class="anchored" data-anchor-id="applications">Applications</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 32%">
<col style="width: 27%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>AI helps offense</th>
<th>AI helps defense</th>
<th style="text-align: center;">Guess at benefit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>WARFARE</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>- assassination</td>
<td>autonomous assassination drones</td>
<td>autonomous anti-drone drones</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="odd">
<td>- battle robots</td>
<td>autonomous attack robots</td>
<td>autonomous defense robots</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td>- camouflage</td>
<td>AI signal disruption</td>
<td>AI signal detection</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>COMPUTER SECURITY</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>- compromise a server</td>
<td>AI fuzzing</td>
<td>AI defensive fuzzing</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="even">
<td>- vulnerabilities in OSS</td>
<td>AI code checking</td>
<td>AI defensive code checking</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="odd">
<td>- spear phishing</td>
<td>AI forgery of phishing emails</td>
<td>AI phishing detector</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>EDUCATION</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>- cheating on problemsets</td>
<td>AI answers the question for you</td>
<td>(none)</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="odd">
<td>- cheating on essays</td>
<td>AI writes the essay</td>
<td>AI detector</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>RESEARCH</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>- forging historical documents</td>
<td>produce an image that looks authentic</td>
<td>recognize whether it’s a forgery</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="odd">
<td>- faking data in research</td>
<td>AI generates fake data</td>
<td>AI detects faked data</td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>CONTENT MODERATION</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>- email spam with link</td>
<td>AI customized spam</td>
<td></td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="odd">
<td>- policy-violating content</td>
<td>AI obsfucation</td>
<td>AI detection</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="even">
<td>- censoring communication</td>
<td>AI obsfucation</td>
<td>AI detection</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="odd">
<td>- forgery/deepfakes</td>
<td>AI</td>
<td></td>
<td style="text-align: center;">offense</td>
</tr>
<tr class="even">
<td>- watermarking</td>
<td>AI watermarking</td>
<td>AI watermark removal</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>WORK</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>- leaking information</td>
<td>AI to obscure activity</td>
<td>AI identifying activity</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="even">
<td>- monitoring productivity</td>
<td>AI to obscure activity</td>
<td>AI identifying activity</td>
<td style="text-align: center;">defense</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td>TRADE</td>
<td></td>
<td></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td>- quality check</td>
<td>compromise on product quality</td>
<td>inspect quality</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Theory points:</p>
<ol type="1">
<li>If finding holes –&gt; favors defense.</li>
<li>If covering surface, &amp; costly –&gt; favors defense (but killer drones).</li>
<li>If forging –&gt; favors</li>
<li>If technology changes quickly — favors offense.</li>
</ol>
</section>
<section id="model" class="level1">
<h1>Model</h1>
<dl>
<dt>The attacker wins if they discover a hole that defense hasn’t discovered.</dt>
<dd>
The two sides spend <span class="math inline">\(c_A\)</span> and <span class="math inline">\(c_D\)</span> on searching for holes, and there’s a density of holes <span class="math inline">\(f(x)\)</span>, so the probability of the attacker winning is: <span class="math display">\[\utt{F(c_A)-F(c_D)}{prob attacker finds}{a hole that defender does not}\]</span>
</dd>
<dt>There’s no pure strategy equilibrium.</dt>
<dd>
If the attacker ever wins, we must have some occasions when <span class="math inline">\(F(c_A)&gt;F(c_D)\)</span>. But they face the same marginal cost, and attacker has lower marginal benefit (bcos <span class="math inline">\(c_A&gt;c_D\)</span>), which is a contradiction. [==fix this==]
</dd>
<dt>Conjecture at a mixed-strategy equilibrium.</dt>
<dd>
Defense plays a fixed <span class="math inline">\(c_D\)</span>. The attacker is indifferent between playing 0 and playing <span class="math inline">\(c_A\)</span> which satisfies: <span class="math display">\[\begin{aligned}
  \utt{f(c_A)}{marginal return}{to effort} &amp;= \utt{1}{marginal}{cost} \\
  \utt{F(c_A)-F(c_D)}{benefit}{from participating} &amp;= \utt{c_A}{cost from}{participating} \\
   \end{aligned}
   \]</span>
</dd>
<dt>How does distribution <span class="math inline">\(f\)</span> affect equilibrium?</dt>
<dd>
<ul>
<li><span class="math inline">\(c_A=f^{-1}(1)\)</span> , so if fat tails then attackers will put in a lot of effort, if thin tails then not so much.</li>
</ul>
</dd>
</dl>
<p>Will be equilibrium when the blue and green are exactly the same size:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025-03-01-offense-defense-balance_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="general-theory-on-offense-defense" class="level1">
<h1>General Theory on Offense-Defense</h1>
<dl>
<dt>Lanchester (1915) <a href="https://en.wikipedia.org/wiki/Lanchester%27s_laws">Lanchester Laws</a></dt>
<dd>
General laws of ratio required by offense and defense in a battle.
</dd>
<dt>Huntington (1958) <a href="https://www.dropbox.com/scl/fi/x3evqh8ei5ltbzvf4wph2/Huntington-Arms-Races-s.pdf?rlkey=3eqa318v7x3q7myyzxirgetom&amp;e=1&amp;dl=0">“Arms Races”</a></dt>
<dd>
(…)
</dd>
<dt>Tullock contest functions.</dt>
<dd>
Typically symmetric. The share of surplus consumed will be inverse to steepness of diminishing returns.
</dd>
<dt>Schneier (2018) <a href="https://www.computer.org/csdl/magazine/sp/2018/02/msp2018020096/13rRUzpQPMi">“Artificial Intelligence and the Attack/Defense Balance”</a></dt>
<dd>
<blockquote class="blockquote">
<p>“Both attack and defense will benefit from AI technologies, but I believe that AI has the capability to tip the scales more toward defense. … defense is currently in a worse position than offense precisely because of the human components. Present-day attacks pit the relative advantages of computers and humans against the relative weaknesses of computers and humans. Computers moving into what are traditionally human areas will rebalance that equation.”</p>
</blockquote>
</dd>
<dt>Glaser &amp; Kaufman (1998) <a href="https://sci-hub.se/10.2307/2539240">What Is the Offense-Defense Balance and How Can We Measure It?</a></dt>
<dd>
<p>They say it’s been an influential theory, and says that war is rare today because technology favors defense over offense.</p>
<blockquote class="blockquote">
<p>“As originally described by Robert Jervis, the two key variables in the theory are (1) the offense-defense balance – whether it is”easier” to take territory or to defend it, and (2) offense-defense distinguishability – whether the forces that support offensive missions are different from those that support defensive missions. The basic predictions concerning the offense-defense balance are that as the advantage of offense increases, the security dilemma becomes more severe, arms races become more intense, and war becomes more likely”</p>
</blockquote>
<p>Definition of the balance:</p>
<blockquote class="blockquote">
<p>“ratio of forces the attacker requires to take territory to the cost of the forces the defender has deployed.”</p>
</blockquote>
</dd>
<dt>Garfinkel &amp; Dafoe (2019) <a href="https://www.tandfonline.com/doi/full/10.1080/01402390.2019.1631810">“How does the offense-defense balance scale?”</a></dt>
<dd>
<p>They conjecture that in many cases growth in resources will favor defense:</p>
<blockquote class="blockquote">
<p>“growth in investments will favor offense when investment levels are sufficiently low and favor defense when they are sufficiently high.”</p>
</blockquote>
</dd>
<dt>Bonfanti (2022) <a href="https://www.research-collection.ethz.ch/bitstream/handle/20.500.11850/569895/10.4324_9781003110224-6_chapterpdf.pdf;jsessionid=C6C82EB047449664F5D228BA7ED7C4C3?sequence=3">Artificial intelligence and the offense-defense balance in cyber security</a></dt>
<dd>
General discussion, <em>“It is difficult to establish which application, defensive or offensive, will benefit relatively more from the integration of AI capabilities.”</em>
</dd>
<dt>Maxwell Tabarrok (2024) <a href="https://www.maximum-progress.com/p/a-theory-of-equilibrium-in-the-offense">“A Theory of Equilibrium in the Offense-Defense Balance”</a></dt>
<dd>
Just says that there will be effects of AI on both defense as well as offense, so you shouldn’t expect partial equilibrium effects of offensive AI to be the full effect. E.g. if there are killer drones then people will go outside less. (also on <a href="https://www.lesswrong.com/posts/FDShX8cmgdKvDWkFJ/a-theory-of-equilibrium-in-the-offense-defense-balance">lesswrong</a>)
</dd>
<dt>Heather Adkins (2024) <a href="https://securityandtechnology.org/blog/technologist-talks-the-offense-defense-balance/">“The Offense-Defense Balance”</a></dt>
<dd>
<p>She says that vulnerability discovery is increasing, &amp; that’s probably driven by LLMs, but it’s unclear whether this is changing the offense-defense balance.</p>
<blockquote class="blockquote">
<p>“Are we going to find vulnerabilities faster on the defense side or the offense side? And then how quickly can we fix them? And that, I think, ultimately is just to make a very complicated conversation very simple, that’s the linchpin in this question. Who’s going to win is going to be who runs faster at the software vulnerability problem, in my view.”</p>
</blockquote>
<blockquote class="blockquote">
<p>“by 2050, I do think we will have systems that are relatively self healing.”</p>
</blockquote>
</dd>
<dt>Bressler, Trager, Dafoe (2021) <a href="https://preprints.apsanet.org/engage/apsa/article-details/60aff17fcb523e8582d8f64e">The Offense-Defense Balance and the Costs of Anarchy: When Welfare Improves Under Offensive Advantage</a></dt>
<dd>
<p>Notes that welfare is generally better when there’s a big asymmetry, as there’s less equilibrium conflict.</p>
<blockquote class="blockquote">
<p>“High defensive advantage is first-best because attacking is difficult and the arms burdens required to deter attacks and maintain peace are low. High offensive advantage is comparatively worse because war is likely, but war tends to be smaller in scale, quicker, and less costly. Intermediate offensive advantage is worst because high arms burdens are required to deter attacks while wars, when they occur, are larger, longer, and more destructive.”</p>
</blockquote>
</dd>
<dt>Jabarian &amp; Imas (2025) <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=5407424">“Artificial Writing &amp; Automated Detection”</a></dt>
<dd>
They evaluate the tradeoff of FNR and FPR among different artificial writing programs, but I think do not consider the equilibrium effects.
</dd>
<dt><span class="citation" data-cites="garfinkel2007conflict">(<a href="#ref-garfinkel2007conflict" role="doc-biblioref"><strong>garfinkel2007conflict?</strong></a>)</span></dt>
<dd>
Good review of the economics of conflict, centered around the Tullock contest function.
</dd>
</dl>
</section>
<section id="general-tullock" class="level1">
<h1>General Tullock</h1>
<p>Let <span class="math inline">\(e_1,e_2\ge 0\)</span> be the effort choices of the two players, and we have general payoff function:</p>
<p><span class="math display">\[P_1(e_1,e_2)\]</span></p>
<p>Simplest properties of CSF: (1) diminishing returns; (2) homogenous; (3) positive cross-partial (&amp; so strategic complements).</p>
<p>Suppose player 1 gets a multiplicative boost, then:</p>
<ol type="1">
<li>If you hold effort fixed then player 1 gets a higher share of winnings.</li>
<li><strong>Player 1 effort falls.</strong> If <span class="math inline">\(\frac{P_1}{de_1}\propto\frac{1}{e_1}\)</span> then player 1’s effort would be unchanged, but we expect marginal returns will fall <em>faster</em> than <span class="math inline">\(1/x\)</span>, because it’s bounded above.</li>
<li><strong>Player 2 effort rises.</strong> Because of strategic complements.</li>
</ol>
</section>
<section id="tullock" class="level1">
<h1>Tullock</h1>
<p>Let <span class="math inline">\(e_1,e_2\ge 0\)</span> be the <strong>effort choices</strong> of the two players, and let <span class="math inline">\(c_1,c_2&gt;0\)</span> be their <strong>marginal costs of effort</strong>.</p>
<ol type="1">
<li><p><strong>Contest success function.</strong> Player 1 wins the prize with probability <span class="math display">\[P_1(e_1,e_2)=\frac{e_1^{r_1}}{e_1^{r_1}+e_2^{r_2}}\]</span> and player 2 wins with <span class="math inline">\(P_2(e_1,e_2)=1-P_1(e_1,e_2)\)</span>.</p></li>
<li><p><strong>Payoffs.</strong> Let the prize be worth <span class="math inline">\(V&gt;0\)</span> to both players. Then player 1’s payoff is <span class="math display">\[u_1(e_1,e_2)=V\,P_1(e_1,e_2)-c_1 e_1
  = V\frac{e_1^{r_1}}{e_1^{r_1}+e_2^{r_2}}-c_1 e_1,\]</span> and symmetrically for player 2: <span class="math display">\[u_2(e_1,e_2)=V\frac{e_2^{r_2}}{e_1^{r_1}+e_2^{r_2}}-c_2 e_2.\]</span></p></li>
<li><p><strong>First-order condition for player 1.</strong> Fix <span class="math inline">\(e_2\)</span> and maximize <span class="math inline">\(u_1(e_1,e_2)\)</span> over <span class="math inline">\(e_1\ge 0\)</span>.</p>
<ol type="1">
<li>Differentiate <span class="math inline">\(P_1\)</span> with respect to <span class="math inline">\(e_1\)</span>: <span class="math display">\[\frac{\partial P_1}{\partial e_1}
  =\frac{r_1 e_1^{r_1-1} e_2^{r_2}}{\bigl(e_1^{r_1}+e_2^{r_2}\bigr)^2}.\]</span></li>
<li>The derivative of <span class="math inline">\(u_1\)</span> is therefore <span class="math display">\[\frac{\partial u_1}{\partial e_1}
  =V\frac{r_1 e_1^{r_1-1} e_2^{r_2}}{\bigl(e_1^{r_1}+e_2^{r_2}\bigr)^2}-c_1.\]</span></li>
<li>An interior best response <span class="math inline">\(e_1&gt;0\)</span> must satisfy the FOC <span class="math display">\[V r_1 e_1^{r_1-1} e_2^{r_2}
  =c_1\bigl(e_1^{r_1}+e_2^{r_2}\bigr)^2. \tag{BR1-FOC}\]</span></li>
</ol></li>
<li><p><strong>Parametric best-response curve for player 1.</strong> It is convenient to re-express the FOC in terms of the ratio <span class="math display">\[t \equiv \frac{e_1^{r_1}}{e_2^{r_2}}, \qquad t&gt;0.\]</span> We can solve for the pair <span class="math inline">\((e_1,e_2)\)</span> that lies on player 1’s best-response locus.</p>
<ol type="1">
<li>Rewrite the FOC using <span class="math inline">\(t\)</span>:
<ol type="1">
<li>Note that <span class="math inline">\(e_1^{r_1}=t e_2^{r_2}\)</span> and hence <span class="math display">\[e_1^{r_1-1}
  =\frac{e_1^{r_1}}{e_1}
  =\frac{t e_2^{r_2}}{e_1}.\]</span></li>
<li>Using <span class="math inline">\(e_1=t^{1/r_1} e_2^{r_2/r_1}\)</span> we get <span class="math display">\[e_1^{r_1-1}
  =t^{(r_1-1)/r_1} e_2^{r_2(1-1/r_1)}.\]</span></li>
<li>Substituting into (BR1-FOC) gives <span class="math display">\[V r_1 t^{(r_1-1)/r_1} e_2^{r_2(2-1/r_1)}
  = c_1 e_2^{2r_2}(t+1)^2.\]</span></li>
<li>Cancelling the common factor <span class="math inline">\(e_2^{r_2(2-1/r_1)}\)</span> yields <span class="math display">\[V r_1 t^{(r_1-1)/r_1}
  = c_1 e_2^{r_2/r_1}(t+1)^2.\]</span></li>
</ol></li>
<li>Solving this for <span class="math inline">\(e_2\)</span> gives the opponent’s effort along player 1’s best-response locus: <span class="math display">\[e_2(t)
  =\Biggl(\frac{V r_1}{c_1}\,
           \frac{t^{(r_1-1)/r_1}}{(1+t)^2}\Biggr)^{\!\!r_1/r_2}.\]</span></li>
<li>Given <span class="math inline">\(e_2(t)\)</span>, player 1’s effort on the best-response curve is <span class="math display">\[e_1(t)
  =t^{1/r_1}\, e_2(t)^{\,r_2/r_1}
  =\frac{V r_1}{c_1}\,\frac{t}{(1+t)^2}.\]</span></li>
</ol></li>
<li><p><strong>Symmetry for player 2.</strong> The same derivation, swapping the indices, yields a parametric best-response curve <span class="math inline">\((e_2(s),e_1(s))\)</span> for player 2, where <span class="math inline">\(s\equiv e_2^{r_2}/e_1^{r_1}\)</span> plays the role of <span class="math inline">\(t\)</span> above.</p></li>
<li><p><strong>Global maximization vs.&nbsp;FOCs.</strong></p>
<ol type="1">
<li>For each fixed <span class="math inline">\(e_2\)</span>, the payoff <span class="math inline">\(u_1(e_1,e_2)\)</span> is continuous on <span class="math inline">\([0,\infty)\)</span> and differentiable for <span class="math inline">\(e_1&gt;0\)</span>, with <span class="math inline">\(\frac{\partial u_1}{\partial e_1}\)</span> given above.</li>
<li>Any interior optimum must satisfy (BR1-FOC), but the converse need not hold in general: a solution of the FOC could in principle be a local minimum rather than a maximum.</li>
<li>In the parameter ranges used in the figures (all <span class="math inline">\(r_i&gt;0\)</span>, linear costs <span class="math inline">\(c_i e_i\)</span>, and <span class="math inline">\(V&gt;0\)</span>), the function <span class="math inline">\(u_1(e_1,e_2)\)</span> is <strong>single-peaked</strong> in <span class="math inline">\(e_1\)</span> for each fixed <span class="math inline">\(e_2\)</span>:
<ol type="1">
<li>As <span class="math inline">\(e_1\downarrow 0\)</span> we have <span class="math inline">\(u_1(e_1,e_2)\to 0\)</span> and <span class="math inline">\(\frac{\partial u_1}{\partial e_1}&gt;0\)</span>.</li>
<li>As <span class="math inline">\(e_1\uparrow\infty\)</span> the cost term <span class="math inline">\(c_1 e_1\)</span> dominates and <span class="math inline">\(u_1(e_1,e_2)\to -\infty\)</span>, while <span class="math inline">\(\frac{\partial u_1}{\partial e_1}&lt;0\)</span> for sufficiently large <span class="math inline">\(e_1\)</span>.</li>
<li>Because the derivative changes sign only once, there is at most one interior critical point, and it must be a global maximum if it is positive; otherwise the unique best response is <span class="math inline">\(e_1^*(e_2)=0\)</span>.</li>
</ol></li>
<li>The TikZ code for the best-response diagrams is built from the parametric formulas <span class="math inline">\((e_1(t),e_2(t))\)</span> and their symmetric counterparts, which select exactly this global-maximum branch. Any visually “two-valued” behavior in earlier drafts came from plotting <em>all</em> algebraic solutions of the FOC, not from multiple global maxima; the current version renders only the economically relevant best response.</li>
</ol></li>
</ol>
<p>For the symmetric benchmark with <span class="math inline">\(r_1=r_2=r\)</span> and <span class="math inline">\(c_1=c_2=c\)</span> this machinery reduces to the familiar expressions. For example, when <span class="math inline">\(r=1\)</span> the scalar best-response function simplifies to <span class="math display">\[e_1(e_2)=\max\{0,\sqrt{V e_2/c}-e_2\},\]</span> and the symmetric equilibrium has <span class="math inline">\(e_1=e_2=V/(4c)\)</span>, with total dissipation <span class="math inline">\(e_1+e_2=V/2\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025-03-01-offense-defense-balance_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025-03-01-offense-defense-balance_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>https://link.springer.com/content/pdf/10.1007/s00199-021-01367-4.pdf</p>
</section>
<section id="miscellaneous" class="level1">
<h1>Miscellaneous</h1>
<ul>
<li><p>Allisat, A. “AI Arms Race: the evolving battle between email spam and spam filters.”</p></li>
<li><p><strong><a href="https://crfm.stanford.edu/open-fms/paper.pdf#:~:text=access%20to%20resources,to%20report%20vulnerabilities">On the Societal Impact of Open Foundation Models</a></strong> – They talk about the “marginal risk”</p></li>
<li><p><a href="https://isi.jhu.edu/wp-content/uploads/2022/04/Adversarial_Attacks_Against_Machine_Learning_Based_SpamFilters__IEEE.pdf">Spam filters</a></p></li>
<li><p><a href="https://news.ycombinator.com/item?id=43295692">HN argument about effect on faking research</a></p></li>
<li><p>Cullen O’Keefe (2025) <a href="https://juralnetworks.substack.com/p/will-ai-lawyers-make-swords-or-shields">Will AI Lawyers Make Swords or Shields?</a></p>
<blockquote class="blockquote">
<p>“When I first thought of the possibility of AI Lawyers, my initial reaction was that AI lawyers will be overall good for the cause of justice. … As I thought about it more, though, I realized I was failing to consider how AI Lawyers might affect prosecution dynamics.”</p>
</blockquote></li>
<li><p><a href="https://www.nytimes.com/2025/02/13/nyregion/students-high-tech-fake-ids.html">NYT Article on Improvements in ID Forgery Technology</a></p></li>
<li><p>Garfinkel and Dafoe (2019) <a href="http://warontherocks.com/2019/12/artificial-intelligence-foresight-and-the-offense-defense-balance/">“Artificial Intelligence, Foresight, and the Offense-Defense Balance”</a></p></li>
<li><h1 id="appendix">Appendix</h1></li>
</ul>
<section id="models" class="level2">
<h2 class="anchored" data-anchor-id="models">models</h2>
<dl>
<dt>Finding holes in a wall -&gt; AI helps defense.</dt>
<dd>
Both sides are trying to find holes. Offense will randomize where it looks. If there are a finite number of holes then improved hole-finding will win.
</dd>
<dt>Guarding a perimeter -&gt; AI helps defense.</dt>
<dd>
Each side chooses some points to cover on a surface. The attacker wins proportional to the uncovered points. It costs something to cover each point.
</dd>
<dt>Inspecting items for quality -&gt; AI helps defense.</dt>
<dd>
You are delivering a cargo of 1000 things. The recipient randomly chooses a fraction for manual inspection. E.g. delivering wool to the auction.
</dd>
<dt>Inspecting items for certification -&gt; AI helps offense.</dt>
<dd>
You are delivering a cargo of 1000 things. The recipient is checking for signs of authenticity, where authenticity is an <em>external</em> property.
</dd>
<dt>Nuclear bomb.</dt>
<dd>
Once you know how to create a nuclear bomb then you can threaten the world. Generally with CBRN.
</dd>
</dl>
</section>
</section>
<section id="tullock-isovalue-curves" class="level1">
<h1>Tullock isovalue curves</h1>
<p>We keep the same basic Tullock contest setup as in the main text, but now focus on <strong>isovalue curves</strong> for the <em>contest success function</em> alone, ignoring costs.</p>
<ol type="1">
<li><p><strong>Contest success function with asymmetry.</strong> Let <span class="math inline">\(e_1,e_2\ge 0\)</span> be the effort choices of the two players, and let <span class="math inline">\(\alpha_1,\alpha_2&gt;0\)</span> capture multiplicative effectiveness (or “quality”) advantages. For exponents <span class="math inline">\(r_1,r_2&gt;0\)</span>, player 1’s probability of winning the prize is<br>
<span class="math display">\[P_1(e_1,e_2)
  =\frac{\alpha_1 e_1^{r_1}}{\alpha_1 e_1^{r_1}+\alpha_2 e_2^{r_2}},\]</span><br>
and player 2’s winning probability is <span class="math inline">\(P_2(e_1,e_2)=1-P_1(e_1,e_2)\)</span>.</p></li>
<li><p><strong>Isovalue definition.</strong> Fix some target success probability <span class="math inline">\(\bar p\in(0,1)\)</span> for player 1. The <strong>isovalue locus</strong> for player 1 at level <span class="math inline">\(\bar p\)</span> is the set of effort pairs <span class="math inline">\((e_1,e_2)\)</span> such that<br>
<span class="math display">\[P_1(e_1,e_2)=\bar p.\]</span></p></li>
<li><p><strong>Solving explicitly for the isovalue curve.</strong> We solve <span class="math inline">\(P_1(e_1,e_2)=\bar p\)</span> for <span class="math inline">\(e_1\)</span> as a function of <span class="math inline">\(e_2\)</span>.</p>
<ol type="1">
<li>Start from the definition:<br>
<span class="math display">\[\bar p
  =\frac{\alpha_1 e_1^{r_1}}{\alpha_1 e_1^{r_1}+\alpha_2 e_2^{r_2}}.\]</span></li>
<li>Multiply both sides by the denominator:<br>
<span class="math display">\[\bar p\bigl(\alpha_1 e_1^{r_1}+\alpha_2 e_2^{r_2}\bigr)
  =\alpha_1 e_1^{r_1}.\]</span></li>
<li>Expand the left-hand side:<br>
<span class="math display">\[\bar p\alpha_1 e_1^{r_1}
  +\bar p\alpha_2 e_2^{r_2}
  =\alpha_1 e_1^{r_1}.\]</span></li>
<li>Subtract <span class="math inline">\(\bar p\alpha_1 e_1^{r_1}\)</span> from both sides to collect the <span class="math inline">\(e_1^{r_1}\)</span> terms:<br>
<span class="math display">\[\bar p\alpha_2 e_2^{r_2}
  =\alpha_1 e_1^{r_1}-\bar p\alpha_1 e_1^{r_1}
  =\alpha_1(1-\bar p)e_1^{r_1}.\]</span></li>
<li>Solve for <span class="math inline">\(e_1^{r_1}\)</span>:<br>
<span class="math display">\[e_1^{r_1}
  =\frac{\bar p\alpha_2}{\alpha_1(1-\bar p)}\,e_2^{r_2}.\]</span></li>
<li>Take the <span class="math inline">\(r_1\)</span>‑th root of both sides to get <span class="math inline">\(e_1\)</span> as a function of <span class="math inline">\(e_2\)</span>:<br>
<span class="math display">\[e_1(e_2)
  =\Biggl(\frac{\bar p\alpha_2}{\alpha_1(1-\bar p)}\Biggr)^{\!1/r_1}
    e_2^{r_2/r_1}.\]</span></li>
</ol></li>
<li><p><strong>Interpretation.</strong></p>
<ol type="1">
<li>For each fixed parameter tuple <span class="math inline">\((r_1,r_2,\alpha_1,\alpha_2,\bar p)\)</span>, the isovalue locus is a simple power function in the <span class="math inline">\((e_2,e_1)\)</span>‑plane.</li>
<li><strong>Asymmetries in effectiveness</strong> <span class="math inline">\((\alpha_1,\alpha_2)\)</span> change the <em>vertical scale</em> of the curve: if player 1 gets a larger <span class="math inline">\(\alpha_1\)</span> (holding everything else fixed), then the constant factor in front of <span class="math inline">\(e_2^{r_2/r_1}\)</span> shrinks, so player 1 can sustain the same winning probability <span class="math inline">\(\bar p\)</span> with <strong>lower effort</strong> <span class="math inline">\(e_1\)</span> for any given opponent effort <span class="math inline">\(e_2\)</span>.</li>
<li><strong>Asymmetries in exponents</strong> <span class="math inline">\((r_1,r_2)\)</span> change the <em>curvature</em> of the isovalue curve via the exponent <span class="math inline">\(r_2/r_1\)</span>. When <span class="math inline">\(r_1=r_2\)</span> the locus is a straight line through the origin; when <span class="math inline">\(r_2\ne r_1\)</span> it becomes a nonlinear curve.</li>
</ol></li>
<li><p><strong>Scaling the axes.</strong> In the figures below we simply re‑label the horizontal axis as player 2’s effort <span class="math inline">\(x_2=e_2\)</span> and the vertical axis as player 1’s effort <span class="math inline">\(x_1=e_1\)</span>, and truncate both axes to the interval <span class="math inline">\([0,100]\)</span> to match the units used elsewhere in the post.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025-03-01-offense-defense-balance_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("tecunningham\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
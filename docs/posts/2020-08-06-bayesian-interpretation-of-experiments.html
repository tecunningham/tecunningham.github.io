<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.357">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Cunningham">
<meta name="dcterms.date" content="2024-06-01">
<meta name="description" content="Tom Cunningham blog">

<title>The Bayesian Interpretation of Experiments | Tom Cunningham</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-12027453-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>
   h1 {  border-bottom: 4px solid black;}
   h2 {  border-bottom: 1px solid #ccc;}
</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="The Bayesian Interpretation of Experiments | Tom Cunningham">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="tecunningham.github.io/posts/2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-1-1.png">
<meta name="twitter:image-height" content="883">
<meta name="twitter:image-width" content="1105">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tom Cunningham</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href=".././about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/testingham" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tom-cunningham-a9433/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://tecunningham.github.io/index.xml" rel="" target=""><i class="bi bi-rss-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=MDB_DgkAAAAJ" rel="" target="">
 <span class="menu-text">scholar</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Bayesian Interpretation of Experiments</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Cunningham </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<section id="summary" class="level1">
<h1>Summary</h1>
<p><strong>Once you commit the original sin of testing for statistical significance you enter upside-down world where good is bad, bad is good.</strong></p>
<p><strong>There are lots of weird implications of significance testing:</strong></p>
<ul>
<li>The significance of a test depends on how many other tests you ran that day.</li>
<li>It’s considered bad practice to make decisions about how long to run an experiment based on early results of that experiment.</li>
<li>It’s considered bad practice to look at statistical relationships between variables that you only thought of after the data was collected.</li>
<li>It’s considered bad practice to talk about an effect which has <span class="math inline">\(p=.051\)</span> in the same way as an effect with <span class="math inline">\(p=.049\)</span>. Some people even say you shouldn’t use the phrase “almost significant” to describe things which are almost significant.</li>
</ul>
<p>These paradoxes confused me for a long time until I started to think of classical inference as Bayesian inference operating under a constraint.</p>
<p><strong>Classical inference can be thought of as Bayesian inference with a hard-coded prior.</strong> In some cases the hard-coded prior will be close to your true prior, and so it’s fine, but in other cases it won’t and it’ll cause bad inferences. To deal with those pathological cases classical inference has built up a structure of additional rules to protect against bad inferences. The rules either specify contexts where you shouldn’t do any inference at all, or they suggest transforming the problem into one where the hard-coded prior is closer to your true prior. Thus we have rules about multiple testing, about data-dependent stopping, and about testing posterior hypotheses.</p>
</section>
<section id="bayesian-vs-classical-inference" class="level1">
<h1>Bayesian vs Classical Inference</h1>
<p>I’ll compare two ways of interpreting experimental estimates. Suppose <code>posterior</code> represents the estimate of an effect that you’ll use in decision-making, then here are two methods for calculating that:</p>
<ol type="1">
<li><strong>Classical.</strong> If the experiment is statistically-significantly different from zero then you use the experimental estimate (<code>posterior=outcome</code>), otherwise you assume no effect (<code>posterior=0</code>). (Technically this should be called “Null Hypothesis Significance Testing”, and I’m giving a slightly exaggerated version of it).</li>
<li><strong>Bayesian.</strong> You set <code>posterior</code> to be a weighted average of <code>outcome</code> and of <code>prior</code>. The prior represents your best-estimate of the effect before the experiment ran. The position of the posterior between those two points depends on the relative tightness of the two distributions: if the confidence intervals from your experiment are tight relative to the uncertainty in your prior then the posterior will be closer to the outcome; if instead the confidence intervals are wide relative to your prior then the then the posterior will end up closer to your prior.</li>
</ol>
<p>Graphically we can show the three distributions:</p>
<div class="cell" data-layout-align="center" data-hash="2020-08-06-bayesian-interpretation-of-experiments_cache/html/unnamed-chunk-1_917aa8191a361af5543ea4510f40bbc2">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classical-inference-as-constrained-prior" class="level1">
<h1>Classical Inference as Constrained Prior</h1>
<p>Suppose our prior was a spike at zero and otherwise uniform. This prior will cause Bayesian inference to behave similarly to classical inferences: when the outcome is small then the posterior will be heavily influenced by the spike, and so will shrink to be very near zero. When the outcome becomes larger then at some point it will escape the gravity of the central spike, and we’ll have <code>posterior~=outcome</code>.</p>
<div class="cell" data-layout-align="center" data-hash="2020-08-06-bayesian-interpretation-of-experiments_cache/html/unnamed-chunk-2_50ef65ea2eb7ad10394d2b7a8069f40d">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="192"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="2020-08-06-bayesian-interpretation-of-experiments_cache/html/unnamed-chunk-3_12030b1f39bfa846d9cf4f41e82f6522">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="192"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="2020-08-06-bayesian-interpretation-of-experiments_cache/html/unnamed-chunk-4_e2552f9e985ee935a1d1faaf257cbd73">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="192"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="2020-08-06-bayesian-interpretation-of-experiments_cache/html/unnamed-chunk-5_81cb88810bb819111a178650367cf751">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2020-08-06-bayesian-interpretation-of-experiments_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="192"></p>
</figure>
</div>
</div>
</div>
<p><strong>The point:</strong> the two graphs at the bottom of the figure are similar: i.e., using a “stat-sig rule” is a not-too-bad approximation of Bayesian inference when you have a fat-tailed prior (and in most cases your prior should be fat-tailed).</p>
</section>
<section id="applications" class="level1">
<h1>Applications</h1>
<p>This angle of seeing the situation makes a lot of crooked things turn straight:</p>
<ol type="1">
<li><p><strong>Everything is continuous.</strong> In the classical framework there’s a sharp distinction between estimates that are significant and not significant. In reality there aren’t sharp edges like this: if something is just-insignificant (<span class="math inline">\(p\)</span>=0.051) you should treat it basically the same as if it’s just-significant (<span class="math inline">\(p\)</span>=0.049).</p></li>
<li><p><strong>You can discount a statistically-significant outcome if it’s unlikely.</strong> Suppose you’re running an experiment and you see a statistically-significant effect on an outcome nobody expected the experiment to move. Then it’s perfectly reasonable to heavily discount that result: you have relatively strong reasons to expect a zero effect, AKA a tight prior around zero, and so your posterior ought to remain close to your prior.</p></li>
<li><p><strong>Most experiments over-estimate the true effect.</strong> In many domains the average experimental effect is zero. This implies that if you measure a positive effect in an experiment then you should expect, if you re-ran that experiment, that the effect would get closer to zero. Likewise if you measure a negative effect then, if you re-ran the experiment, you should expect the effect go up towards zero. This shrinkage towards zero is especially true for effects that are noisy (when you have wide confidence intervals), and for outcomes that are hard to move (when your prior is narrow).</p></li>
<li><p><strong>You don’t need to worry about peeking.</strong> In the classical framework you should set and forget: it’s bad practice to make decisions about how long to run the experiment after already seeing some of the results, because you can strategically choose the length of the experiment to almost guarantee a significant result even when there’s no true effect. But if you’re interpreting experiments in a Bayesian fashion it doesn’t matter: each time you increase the sample size the experimental estimate (i) moves closer to the true effect, and (ii) gets tighter confidence intervals; but it won’t cause any bias.</p></li>
<li><p><strong>You don’t need to adjust for multiple comparisons.</strong> You should never adjust for the number of tests you’re doing – you should only adjust for the strength of your priors. The reason that people often feel they need to do multiple-comparison adjustments is because there’s an <em>empirical</em> association between number-of-comparisons and strength-of-priors: when someone is testing a lot of different treatments or outcomes it’s often because they have weak priors that any one of them would work, and those weak priors imply they should be relatively more conservative with the evidence. But number of tests is only a proxy, the true reason for adjustment is the strength of your priors.</p></li>
<li><p><strong>It’s OK to come up with hypotheses after the experiment has run.</strong> It’s not allowed in classical model to run extra tests you hadn’t planned, but there’s no problem in the Bayesian framework as long as you’re rigidly honest about your priors. I.e., if you state the same prior you would’ve stated before seeing the data.</p></li>
</ol>
</section>
<section id="why-does-the-classical-framework-survive" class="level1 page-columns page-full">
<h1>Why Does the Classical Framework Survive?</h1>
<p><strong>Why do we still teach &amp; use the classical framework?</strong></p>
<p>You can think of the classical setup as a <em>constrained</em> version of the Bayesian interpretation in which you effectively use same prior for all experiments.</p>
<p>In the Bayesian interpretation you must supply a prior, and the shape of the prior is essentially a judgment call about what you think of as the nature of the existing evidence. The classical setup removes that judgment call and replaces it with a rigid rule.</p>
<p><strong>This can have two justifications:</strong></p>
<ol type="1">
<li><p>The psychological justification is that people have a weakness for misremembering their expectations, and thinking they predicted what actually happened. The classical rule constraints you from doing that.</p></li>
<li><p>The organizational justification is that people will tend to misrepresent their expectation to <em>others</em>. People who run experiments face very strong incentives in interpreting their outcomes – shipping &amp; promotion, publication &amp; tenure – and so often they can’t be trusted to be neutral reporters of what is a reasonable prior.</p></li>
</ol>
<div class="page-columns page-full"><p>Like plastic cutlery, we use significance-testing as a way of protecting you from hurting yourself and others.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;Tukey: “The tool that is so dull that you cannot cut yourself on it is not likely to be sharp enough to be either useful or helpful.”</p></li></div></div>
<p>I personally think this is a reasonable way of trying to soften these psychological and organizational problems – but I think the way it’s taught often confuses people. It’s much easier to understand the paradoxes of hypothesis-testing if we remember:</p>
<p><strong>Hypothesis testing is motivated by psychological &amp; organizational constraints, not by statistical considerations.</strong></p>
<p>You should think of the rules of significance-testing as <em>etiquette</em>, not as statistics: i.e.&nbsp;we consider certain practices “bad form” not because they’re bad inferences but because they’re socially harmful.</p>
</section>
<section id="notes" class="level1">
<h1>Notes</h1>
<p><strong>Straussian reading of statistics.</strong> Strauss says that if you observe an author contradicting themselves you should look to see if there’s a deeper meaning that they are trying to convey, or if there are two audiences they’re trying to talk to. I think most frequentists are operating under this constraint: they’re trying to both (1) explain how to do inference from data; (2) discourage people from taking too much license in interpretation.</p>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Cunningham">
<meta name="dcterms.date" content="2025-11-19">
<meta name="description" content="Tom Cunningham blog">

<title>LLM Time-Saving and Demand Theory | Tom Cunningham – Tom Cunningham</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d5e7c60e6424aa6ccf163f01508596ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-12027453-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script>window.MathJax = {
   loader: { load: ["https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/xypic.js"]},
   tex: {packages: {'[+]': ['xypic','bm']},
         macros: {  bm: ["\\boldsymbol{#1}", 1],
                    ut: ["\\underbrace{#1}_{\\text{#2}}", 2],
                    utt: ["\\underbrace{#1}_{\\substack{\\text{#2}\\\\\\text{#3}}}", 3] }
   }
};
</script>
<style>
   h1 {  border-bottom: 8px solid #557;}
   h2 {  border-bottom: 1px solid #ccc;}
   .greyproof {
      background-color: #f5f5f5;
      padding: 1em;
      margin: 1em 0;
      border-radius: 4px;
   }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="LLM Time-Saving and Demand Theory | Tom Cunningham">
<meta name="twitter:description" content="Tom Cunningham blog">
<meta name="twitter:image" content="tecunningham.github.io/posts/2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-1-1.png">
<meta name="twitter:image-height" content="660">
<meta name="twitter:image-width" content="1326">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tom Cunningham</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href=".././about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/testingham"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tom-cunningham-a9433/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://tecunningham.github.io/index.xml"> <i class="bi bi-rss-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=MDB_DgkAAAAJ"> 
<span class="menu-text">scholar</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">LLM Time-Saving and Demand Theory</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Cunningham </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 19, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<dl>
<dt>I anticipate that we’re going to be arguing a lot about LLM-speedups &amp; task substitution over the next year.</dt>
<dd>
<ul>
<li>Suppose an LLM speeds you up by a factor <span class="math inline">\(\beta\)</span> on tasks that take up share <span class="math inline">\(s\)</span> of your work (pre-LLM), what’s the overall efficiency gain?</li>
<li>How does the answer change if you measure the time-share <span class="math inline">\(s\)</span>, <em>after</em> you adjust to use LLMs?</li>
</ul>
</dd>
<dt>Quick checklist:</dt>
<dd>
<p>Suppose an LLM reduces the time-requirement by 50% on tasks that take up 10% of your time.</p>
<ol type="1">
<li><p>The total efficiency gain will be between <span class="math inline">\(s\beta/(1-s+s/\beta)\)</span> (if perfect complements) and <span class="math inline">\(\beta\)</span> (perfect substitutes).</p></li>
<li><p>If the time-savings are tiny then Hulten’s theorem applies (saving=<span class="math inline">\(s\ln\beta\)</span>)</p></li>
<li><p>If the time-savings are small then you can use elasticity of substitution (there’s a closed-form expression but it’s ugly)</p></li>
<li><p>If the time-savings are large then you should use the entire area under the demand curve (i.e.&nbsp;not reasonable to assume constant elasticity). Though in demand theory this relies on income effects being small, &amp; I think a sufficient condition is that the expenditure share is small. When the expenditure share is large I’m not confident how to think about this.</p></li>
<li><p>Applying Amdahl’s law ex-ante will under-estimate productivity improvements, applying it ex-post will over-estimate productivity improvements.</p></li>
</ol>
</dd>
<dt>A nice analogy: suppose we discover a trick to turn lead into gold, so the price falls by 99%. How much benefit do I get?</dt>
<dd>
<p>Using ex ante expenditure: my expenditure share on gold is ~0%, so my benefit is very small.</p>
<p>Using ex post expenditure: if gold is cheap then I’ll start buying gold cutlery. Suppose I spend $1K on gold/year, then it makes it look like I’m getting value worth $100K/year, which is clearly wrong.</p>
<p>I think the resolution is that gold has high substitutability with other goods (steel, bronze), and so demand is highly elastic. But that substitutability only appears when prices are low, so just estimating a CES function I think would get this wrong.</p>
</dd>
<dt>There are some nice crisp results from economics that apply here.</dt>
<dd>
I discuss some related literature below.
</dd>
</dl>
</section>
<section id="model" class="level1">
<h1>Model</h1>
<p>We set up a two-task CES production problem and derive the optimal time split, the implied output, and the response to productivity changes, with limits for common special cases.</p>
<p><strong>Practical implications (at a glance)</strong></p>
<p>Let <span class="math inline">\(s\equiv t_2^*\)</span> denote the optimal time share on task 2 (and <span class="math inline">\(1-s=t_1^*\)</span>). Express all effects as log-changes <span class="math inline">\(\Delta\ln y^*=\ln\!\big(y^{*'}/y^*\big)\)</span> when task-2 productivity moves from <span class="math inline">\(A_2\)</span> to <span class="math inline">\(A_2'=\beta A_2\)</span>. The last column plugs in <span class="math inline">\(s=0.1\)</span> and <span class="math inline">\(\beta=2\)</span>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 33%">
<col style="width: 21%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Output effect (<span class="math inline">\(\Delta\ln y^*\)</span>)</th>
<th>Intuition</th>
<th>Example <span class="math inline">\(\Delta\ln y^*\)</span> (<span class="math inline">\(s=0.1,\ \beta=2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>General finite change</td>
<td><span class="math inline">\(\dfrac{1}{\varepsilon-1}\ln\!\big((1-s)+s\,\beta^{\varepsilon-1}\big)\)</span></td>
<td>CES-weighted average of the shock</td>
<td><span class="math inline">\(\dfrac{1}{\varepsilon-1}\ln\!\big(0.9+0.1\times2^{\varepsilon-1}\big)\)</span> (depends on <span class="math inline">\(\varepsilon\)</span>)</td>
</tr>
<tr class="even">
<td>Perfect substitutes (<span class="math inline">\(\varepsilon\rightarrow\infty\)</span>)</td>
<td><span class="math inline">\(\ln \beta\)</span></td>
<td>All time moves to the better task</td>
<td><span class="math inline">\(\approx 0.69\)</span></td>
</tr>
<tr class="odd">
<td>Cobb–Douglas (<span class="math inline">\(\varepsilon=1\)</span>)</td>
<td><span class="math inline">\(s\,\ln \beta\)</span></td>
<td>Log-linear weighting by the task share</td>
<td><span class="math inline">\(\approx 0.069\)</span></td>
</tr>
<tr class="even">
<td>Perfect complements (<span class="math inline">\(\varepsilon\rightarrow0\)</span>)</td>
<td><span class="math inline">\(-\ln\!\big((1-s)+s/\beta\big)\)</span></td>
<td>Bottlenecked by the slow task</td>
<td><span class="math inline">\(\approx 0.051\)</span></td>
</tr>
<tr class="odd">
<td>Infinitesimal change (Hulten)</td>
<td><span class="math inline">\(s\,d\ln A_2\)</span></td>
<td>Percent gain equals time share on improved task</td>
<td><span class="math inline">\(0.1\times\ln 2\approx 0.069\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Setup and parameters</strong></p>
<ul>
<li>Time endowment is <span class="math inline">\(1\)</span>; choose <span class="math inline">\(t_1\in[0,1]\)</span> and <span class="math inline">\(t_2=1-t_1\)</span>.</li>
<li>Productivities: <span class="math inline">\(A_1&gt;0\)</span> for task <span class="math inline">\(1\)</span>, <span class="math inline">\(A_2&gt;0\)</span> for task <span class="math inline">\(2\)</span>.</li>
<li>Taste weight: <span class="math inline">\(\alpha\in(0,1)\)</span> on task <span class="math inline">\(1\)</span>.</li>
<li>Substitution parameter: <span class="math inline">\(\varepsilon&gt;0\)</span>; take <span class="math inline">\(\varepsilon\neq1\)</span> for the algebra and then send <span class="math inline">\(\varepsilon\rightarrow1\)</span> for the Cobb–Douglas limit.</li>
<li>Output aggregator (CES): <span class="math display">\[y(t_1,t_2)=\left(\alpha(A_1 t_1)^{\frac{\varepsilon-1}{\varepsilon}}+(1-\alpha)(A_2 t_2)^{\frac{\varepsilon-1}{\varepsilon}}\right)^{\frac{\varepsilon}{\varepsilon-1}}.\]</span></li>
</ul>
<p><strong>Assumptions</strong></p>
<ol type="1">
<li>Feasible set: <span class="math inline">\(t_1\in[0,1]\)</span>, <span class="math inline">\(t_2=1-t_1\)</span>.</li>
<li>Parameters satisfy <span class="math inline">\(A_i&gt;0\)</span> and <span class="math inline">\(\alpha\in(0,1)\)</span>.</li>
<li>Decision problem: choose <span class="math inline">\(t_1\)</span> to maximise <span class="math inline">\(y(t_1,1-t_1)\)</span>.</li>
</ol>
<p><strong>Proposition 1 (optimal time split).</strong> The interior optimum is <span class="math display">\[t_1^*=\frac{1}{1+\left(\frac{1-\alpha}{\alpha}\right)^{\varepsilon}\left(\frac{A_2}{A_1}\right)^{\varepsilon-1}},\qquad t_2^*=1-t_1^*.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Write the Lagrangian <span class="math inline">\(\mathcal{L}=y(t_1,t_2)+\lambda(1-t_1-t_2)\)</span> with <span class="math inline">\(y\)</span> as above.</li>
<li>First-order conditions (interior): <span class="math inline">\(\partial\mathcal{L}/\partial t_1=0\)</span> and <span class="math inline">\(\partial\mathcal{L}/\partial t_2=0\)</span> give <span class="math display">\[\lambda=\alpha\,A_1^{\frac{\varepsilon-1}{\varepsilon}}\,t_1^{-\frac{1}{\varepsilon}}\,y^{\frac{1}{\varepsilon}}=(1-\alpha)\,A_2^{\frac{\varepsilon-1}{\varepsilon}}\,t_2^{-\frac{1}{\varepsilon}}\,y^{\frac{1}{\varepsilon}}.\]</span></li>
<li>Cancel <span class="math inline">\(y^{\frac{1}{\varepsilon}}\)</span> and rearrange to obtain <span class="math inline">\(\frac{t_2}{t_1}=\left(\frac{1-\alpha}{\alpha}\right)^{\varepsilon}\left(\frac{A_2}{A_1}\right)^{\varepsilon-1}\)</span>.</li>
<li>Impose <span class="math inline">\(t_1+t_2=1\)</span> and solve for <span class="math inline">\(t_1^*\)</span>; set <span class="math inline">\(t_2^*=1-t_1^*\)</span>.</li>
<li>The interior solution is valid for <span class="math inline">\(\varepsilon&gt;0\)</span> with finite <span class="math inline">\(A_i\)</span>; only the perfect-substitutes limit <span class="math inline">\(\varepsilon\rightarrow\infty\)</span> or <span class="math inline">\(A_i\rightarrow0\)</span> forces a corner.</li>
</ol>
<p><strong>Proposition 2 (indirect output).</strong> At <span class="math inline">\(t_1^*,t_2^*\)</span> the output is <span class="math display">\[y^*=\Big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\Big)^{\frac{1}{\varepsilon-1}}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Substitute <span class="math inline">\(t_1^*,t_2^*\)</span> from Proposition 1 into <span class="math inline">\(y(t_1,t_2)\)</span>.</li>
<li>Factor out <span class="math inline">\(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\)</span> inside the braces; the exponent <span class="math inline">\(\frac{\varepsilon}{\varepsilon-1}\)</span> collapses to the stated form.</li>
</ol>
<p><strong>Proposition 3 (infinitesimal productivity change).</strong> Holding <span class="math inline">\(A_1\)</span> fixed, a small change in <span class="math inline">\(A_2\)</span> satisfies <span class="math display">\[\frac{dy^*}{y^*}=t_2^*\,\frac{dA_2}{A_2}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Take <span class="math inline">\(\log y^*=\frac{1}{\varepsilon-1}\log\big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\big)\)</span>.</li>
<li>Differentiate with respect to <span class="math inline">\(\log A_2\)</span>: <span class="math display">\[\frac{dy^*}{y^*}=\frac{(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}}{\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}}\cdot\frac{dA_2}{A_2}.\]</span></li>
<li>The fraction equals <span class="math inline">\(t_2^*\)</span> from Proposition 1, so the result follows.</li>
</ol>
<p><strong>Proposition 4 (finite productivity change on task 2).</strong> If <span class="math inline">\(A_2'=\beta A_2\)</span> with <span class="math inline">\(\beta&gt;0\)</span>, then <span class="math display">\[\frac{y^{*'}}{y^*}=\left(t_1^*+(1-t_1^*)\beta^{\varepsilon-1}\right)^{\frac{1}{\varepsilon-1}}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Replace <span class="math inline">\(A_2\)</span> by <span class="math inline">\(\beta A_2\)</span> in <span class="math inline">\(y^*\)</span> from Proposition 2: <span class="math display">\[y^{*'}=\Big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}(\beta A_2)^{\varepsilon-1}\Big)^{\frac{1}{\varepsilon-1}}.\]</span></li>
<li>Factor out the old level <span class="math inline">\(y^*\)</span> to form a ratio; the remaining weights inside the braces are <span class="math inline">\(t_1^*\)</span> and <span class="math inline">\(t_2^*=1-t_1^*\)</span>, giving the stated expression.</li>
</ol>
<p><strong>Proposition 5 (canonical limits).</strong> Take limits of Proposition 4:</p>
<ul>
<li>Cobb–Douglas (<span class="math inline">\(\varepsilon\rightarrow1\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \beta^{1-\alpha}\)</span> and <span class="math inline">\(t_i^*\)</span> is unchanged.</li>
<li>Perfect complements (<span class="math inline">\(\varepsilon\rightarrow0\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \frac{1}{t_1^*+t_2^*/\beta}\)</span>.</li>
<li>Perfect substitutes (<span class="math inline">\(\varepsilon\rightarrow\infty\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \beta\)</span> with <span class="math inline">\(t_2^*\rightarrow1\)</span> if <span class="math inline">\(\beta A_2&gt;A_1\)</span>.</li>
</ul>
<p><em>Proof sketch</em> For <span class="math inline">\(\varepsilon\rightarrow1\)</span> apply L’Hôpital to the CES form. For <span class="math inline">\(\varepsilon\rightarrow0\)</span> the CES aggregator converges to <span class="math inline">\(\min\{A_1 t_1,A_2 t_2\}\)</span>. For <span class="math inline">\(\varepsilon\rightarrow\infty\)</span> it converges to <span class="math inline">\(\max\{A_1 t_1,A_2 t_2\}\)</span>. Substitute these limits into Proposition 4 and simplify.</p>
</section>
<section id="example-applications" class="level1">
<h1>Example Applications</h1>
<dl>
<dt><span class="citation" data-cites="anthropic2025estimatingproductivitygains">@anthropic2025estimatingproductivitygains</span></dt>
<dd>
They estimate Claude saves time by 80% on certain tasks, and apply Hulten’s theorem. But Hulten’s theorem only applies for <em>small</em> efficiency chanages, so I believe this effectively assumes Cobb-Douglas substitution (i.e.&nbsp;constant time-shares on these tasks).
</dd>
<dt><span class="citation" data-cites="becker2025uplift">@becker2025uplift</span></dt>
<dd>
They estimate time-savings on tasks using LLMs. In this case the subjects mostly were <em>not</em> using AI, but in followup studies they <em>will</em> be using AI. This makes it hard to think about interpreting uplift studies over time, insofar as AI causes them to change the task distribution. It would be nice to have a good clear language here.
</dd>
</dl>
</section>
<section id="related-theory" class="level1">
<h1>Related Theory</h1>
<dl>
<dt>Index numbers and the “which share do you weight by?” problem</dt>
<dd>
<span class="citation" data-cites="caves1982indexnumbers">@caves1982indexnumbers</span> formalize why productivity (or “quantity”) measurement becomes an index-number problem as soon as <em>shares move endogenously</em>. Their key point is that fixed-weight indices answer the wrong question when agents substitute:
</dd>
<dd>
<ul>
<li>A Laspeyres-style measure (base-period weights) is biased toward <em>understating</em> gains when a shock makes you reallocate toward the improved input/task, because it freezes the old bundle.</li>
</ul>
</dd>
<dd>
<ul>
<li>A Paasche-style measure (end-period weights) is biased toward <em>overstating</em> gains if you implicitly treat the new bundle as if it had always been purchased at the old relative prices/technologies.</li>
</ul>
</dd>
<dd>
<ul>
<li>The object you actually want is a path (Divisia) integral of share-weighted growth rates; “superlative” discrete indices (e.g., Fisher/Törnqvist) are designed to approximate that integral well.</li>
</ul>
</dd>
<dd>
<strong>Connection to our setup:</strong> our two-task CES makes this completely explicit. Proposition 3 is the Divisia/Hulten-style statement: <span class="math display">\[d\ln y^* = t_2^*, d\ln A_2,\]</span> so the “right weight” is the <em>current</em> optimal time share (t_2^*), not a fixed pre/post share. For a finite () shock, the exact change is the integral of that weight along the adjustment path, which collapses to the closed form in Proposition 4. This is exactly the sense in which “ex‑ante Amdahl/Hulten” (freeze (t_2) at baseline) understates and “ex‑post Hulten” (freeze (t_2) at the endpoint) can overstate.
</dd>
<dt>Consumer surplus / welfare for large “price” (time-cost) changes</dt>
<dd>
<span class="citation" data-cites="willig1976consumerssurplus">@willig1976consumerssurplus</span> defends using Marshallian consumer surplus as a welfare proxy: the area under the (Marshallian) demand curve is close to the Hicksian objects (EV/CV) when income effects are small, and Willig provides conditions/bounds under which the approximation error is limited.
</dd>
<dd>
<span class="citation" data-cites="hausman1981exact">@hausman1981exact</span> shows how to compute exact welfare measures (EV/CV, deadweight loss) from an estimated demand curve by imposing integrability (i.e., that the demand actually comes from some underlying utility/expenditure function).
</dd>
<dd>
<span class="citation" data-cites="deaton1980aids">@deaton1980aids</span> provides a workhorse <em>integrable</em> demand system (AIDS) that flexibly captures income effects and substitution patterns while keeping welfare calculations coherent.
</dd>
<dd>
<strong>Connection to our setup:</strong> if you reinterpret the model in dual form, “task outputs” (x_i=A_i t_i) are the “goods,” and the time budget implies prices (p_i = 1/A_i) (time per unit of task output). An LLM that raises (A_2) by () is literally a price drop for good 2 by a factor (1/). For small task shares (s=t_2^<em>) (your “gold is tiny in the budget” example), the Willig logic says “income-effect-like problems are muted,” so simple surplus approximations are safer. When the effective budget share is not tiny—or when the shock is huge—the Hausman/Deaton-Muellbauer message is: you want an </em>integrable system* (or in our case, an explicit aggregator like CES) so that “area under a curve” corresponds to a defensible welfare change.
</dd>
<dt>Economics of time allocation (time is a scarce input with shadow prices)</dt>
<dd>
<span class="citation" data-cites="deserpa1971time">@deserpa1971time</span> treats time as a fundamental scarce resource: activities require time as well as market goods, and constraints on required time generate a shadow value of time. The key conceptual result is that “time-saving” innovations matter because they relax a binding constraint, and the value of that relaxation depends on the shadow price of time and substitution across activities.
</dd>
<dd>
<strong>Connection to our setup:</strong> we’re essentially running the cleanest possible DeSerpa-style problem: a single time endowment allocated across tasks, where task technologies (A_i) turn time into effective task output. The LLM shock is a direct relaxation of the time requirement for task 2. What DeSerpa adds conceptually is the interpretation: the welfare/productivity effect is not “minutes saved” per se, but “minutes saved <em>valued at the shadow price of time</em>,” and that shadow price is determined jointly with substitution across tasks—exactly what () is doing for us.
</dd>
<dt>Task substitution and computerization as task-specific technology shocks</dt>
<dd>
<span class="citation" data-cites="autor2003skill">@autor2003skill</span> is the empirical foundation for the modern “tasks” approach: computerization substitutes for routine tasks and complements non-routine tasks, shifting task content within occupations and generating distributional consequences (e.g., polarization). The paper’s core claim is that you cannot summarize tech change as “labor-augmenting” in the aggregate; it’s task-directed, and substitution patterns matter.
</dd>
<dd>
<span class="citation" data-cites="acemoglu2011handbook">@acemoglu2011handbook</span> synthesizes and formalizes this task-based view. A central message is that the impact of a task-specific productivity shock depends on: (i) which tasks are affected, (ii) how substitutable tasks are, and (iii) how the economy re-optimizes task assignment across workers/technologies.
</dd>
<dd>
<strong>Connection to our setup:</strong> our (A_2A_2) change is exactly a “task-directed” shock. Your entire “ex‑ante vs ex‑post task share (P)” issue is basically the same point Autor/Acemoglu-Autor emphasize: task shares are endogenous responses to technology, not fixed primitives. In our CES aggregator, that endogeneity is governed by (<span class="math inline">\(\varepsilon\)</span>): when (<span class="math inline">\(\varepsilon\)</span>) is high, reallocation is large and the “Amdahl intuition” breaks; when (<span class="math inline">\(\varepsilon\)</span>) is low, reallocation is small and Amdahl becomes accurate.
</dd>
<dt>Hulten’s theorem and when first-order share-weighting breaks</dt>
<dd>
<span class="citation" data-cites="hulten1978growth">@hulten1978growth</span> shows (in a competitive, CRS setting with intermediates) that a <em>small</em> productivity shock’s effect on aggregate productivity can be summarized by share-weighted sectoral TFP growth (Domar/revenue-share weights). The key takeaway is the legitimacy of first-order share weighting—but only locally.
</dd>
<dd>
<strong><span class="citation" data-cites="baqaee2019macro">@baqaee2019macro</span></strong> pushes beyond that local logic: in production networks, micro shocks can have macro consequences and nonlinearities/higher-order terms matter, especially for large shocks or when substitution patterns interact with network structure.
</dd>
<dd>
<span class="citation" data-cites="baqaeeBurstein2021incomeeffects">@baqaeeBurstein2021incomeeffects</span> highlights that welfare vs.&nbsp;output can diverge when income effects / demand shifts are important, and that changing expenditure patterns can be central to aggregate responses (so “just Domar weights” can miss key welfare channels).
</dd>
<dd>
<span class="citation" data-cites="cominLashkariMestieri2021structuralchange">@cominLashkariMestieri2021structuralchange</span> emphasizes that over longer horizons, relative price changes and non-homotheticities induce structural change: shares drift systematically, so you should expect “task/sector shares” to be part of the response to technology, not a nuisance.
</dd>
<dd>
<strong>Connection to our setup:</strong> Proposition 3 is the Hulten logic in a two-task world (local, share-weighted). Proposition 4 is the “nonlinear / finite change” version where the share itself moves with (<span class="math inline">\(\beta\)</span>). And your concern about <em>large</em> AI speedups is exactly the Baqaee/Comin-style warning: the “right weight” is not a constant (P); it is an equilibrium object that can move a lot.
</dd>
<dt>Amdahl’s law as the perfect-complements benchmark</dt>
<dd>
Amdahl’s law says the speedup from improving one component is bounded by the unimproved fraction.
</dd>
<dd>
<strong>Connection to our setup:</strong> that’s precisely the () (Leontief / perfect complements) limit in Proposition 5:
</dd>
<dd>
[ ,] which is Amdahl’s formula with (P=s). So Amdahl is not “wrong,” it’s the <em>knife-edge</em> case where tasks are bottleneck complements and reallocation can’t help.
</dd>
<dt>Reallocation and aggregation across units (Olley–Pakes)</dt>
<dd>
<strong><span class="citation" data-cites="olley1996telecom">@olley1996telecom</span></strong> shows that aggregate productivity can be decomposed into: (i) the <strong>unweighted mean</strong> productivity across firms (“within”), plus (ii) a <strong>covariance between productivity and market share</strong> (“between” / reallocation). Their empirical contribution is that changes in aggregate productivity can come as much from reallocating activity toward more productive firms as from within-firm improvements.
</dd>
<dd>
<strong>Connection to our setup:</strong> our core model is within-agent time reallocation across tasks. But as soon as you move from “one worker” to “many workers/firms adopting AI heterogeneously,” the Olley–Pakes logic becomes the natural accounting identity: aggregate gains combine (a) within-unit LLM time-savings and (b) reallocation of work/market share toward units where AI raises productivity most. This is a clean way to separate “Claude makes me faster” from “the economy shifts toward people/teams for whom Claude is most valuable,” which is otherwise easy to confound when you look only at ex-post shares.
</dd>
</dl>
</section>
<section id="illustrations" class="level1">
<h1>Illustrations</h1>
<section id="output-gains-vs.-elasticity-varepsilon" class="level2">
<h2 class="anchored" data-anchor-id="output-gains-vs.-elasticity-varepsilon">Output gains vs.&nbsp;elasticity (<span class="math inline">\(\varepsilon\)</span>)</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Finite productivity gain from <span class="math inline">\(A_2' = \beta A_2\)</span> as a function of substitutability <span class="math inline">\(\varepsilon\)</span> (with <span class="math inline">\(s=t_2^*\)</span> held fixed). The curve interpolates between the perfect-complements bound <span class="math inline">\(-\ln((1-s)+s/\beta)\)</span> and the perfect-substitutes bound <span class="math inline">\(\ln\beta\)</span>, with the Cobb–Douglas point <span class="math inline">\(s\ln\beta\)</span> at <span class="math inline">\(\varepsilon=1\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="optimal-time-share-t_2-vs.-relative-productivity-a_2a_1" class="level2">
<h2 class="anchored" data-anchor-id="optimal-time-share-t_2-vs.-relative-productivity-a_2a_1">Optimal time share <span class="math inline">\(t_2^*\)</span> vs.&nbsp;relative productivity (<span class="math inline">\(A_2/A_1\)</span>)</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Optimal time share on task 2, <span class="math inline">\(t_2^*\)</span>, as a function of relative productivity <span class="math inline">\(r\equiv A_2/A_1\)</span> for different elasticities <span class="math inline">\(\varepsilon\)</span> (here illustrated with <span class="math inline">\(\alpha=1/2\)</span> so <span class="math inline">\(t_2^* = r^{\varepsilon-1}/(1+r^{\varepsilon-1})\)</span>). For <span class="math inline">\(\varepsilon&gt;1\)</span>, higher <span class="math inline">\(A_2/A_1\)</span> increases <span class="math inline">\(t_2^*\)</span> (reallocation toward the improved task). For <span class="math inline">\(\varepsilon&lt;1\)</span>, higher <span class="math inline">\(A_2/A_1\)</span> decreases <span class="math inline">\(t_2^*\)</span> (you need <em>less</em> time on the now-more-productive complementary task).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="geometry-a-shock-a_2beta-a_2-rotates-the-feasible-frontier" class="level2">
<h2 class="anchored" data-anchor-id="geometry-a-shock-a_2beta-a_2-rotates-the-feasible-frontier">Geometry: a shock <span class="math inline">\(A_2'=\beta A_2\)</span> rotates the feasible frontier</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Geometric view in task-output space <span class="math inline">\(x_i\equiv A_i t_i\)</span>. The time constraint implies <span class="math inline">\(x_1/A_1 + x_2/A_2 = 1\)</span>. A productivity shock <span class="math inline">\(A_2' = \beta A_2\)</span> rotates the feasible set outward in the <span class="math inline">\(x_2\)</span> direction. Starting from <span class="math inline">\(A_1=A_2\)</span> (so the pre-shock optimum is <span class="math inline">\(t_2^*=1/2\)</span> for any <span class="math inline">\(\varepsilon\)</span> when <span class="math inline">\(\alpha=1/2\)</span>), the post-shock optimum shifts toward <em>more</em> <span class="math inline">\(t_2^*\)</span> when <span class="math inline">\(\varepsilon&gt;1\)</span> and toward <em>less</em> <span class="math inline">\(t_2^*\)</span> when <span class="math inline">\(\varepsilon&lt;1\)</span>.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="indifference-curve" class="level2">
<h2 class="anchored" data-anchor-id="indifference-curve">Indifference Curve</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Budget constraint and optimal allocations under different elasticities</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="demand-curve" class="level2">
<h2 class="anchored" data-anchor-id="demand-curve">Demand Curve</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Demand curves with different price elasticities</figcaption>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("tecunningham\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
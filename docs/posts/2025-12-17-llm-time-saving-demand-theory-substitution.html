<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tom Cunningham">
<meta name="dcterms.date" content="2026-01-13">
<meta name="description" content="Tom Cunningham blog">

<title>LLM Time-Saving and Demand Theory | Tom Cunningham – Tom Cunningham</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d5e7c60e6424aa6ccf163f01508596ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-12027453-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script>window.MathJax = {
   loader: { load: ["https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/xypic.js"]},
   tex: {packages: {'[+]': ['xypic','bm']},
         macros: {  bm: ["\\boldsymbol{#1}", 1],
                    ut: ["\\underbrace{#1}_{\\text{#2}}", 2],
                    utt: ["\\underbrace{#1}_{\\substack{\\text{#2}\\\\\\text{#3}}}", 3] }
   }
};
</script>
<style>
   h1 {  border-bottom: 8px solid #557;}
   h2 {  border-bottom: 1px solid #ccc;}
   .greyproof {
      background-color: #f5f5f5;
      padding: 1em;
      margin: 1em 0;
      border-radius: 4px;
   }
</style>
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
<meta name="twitter:title" content="LLM Time-Saving and Demand Theory | Tom Cunningham">
<meta name="twitter:description" content="Tom Cunningham blog">
<meta name="twitter:image" content="tecunningham.github.io/posts/2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-1-1.png">
<meta name="twitter:image-height" content="813">
<meta name="twitter:image-width" content="955">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Tom Cunningham</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href=".././about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/testingham"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tom-cunningham-a9433/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://tecunningham.github.io/index.xml"> <i class="bi bi-rss-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=MDB_DgkAAAAJ"> 
<span class="menu-text">scholar</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">LLM Time-Saving and Demand Theory</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tom Cunningham </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 13, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Many thanks to Elsie Jang for discussion.</p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<dl>
<dt>I anticipate that we’re going to be arguing a lot about LLM-speedups &amp; task substitution over the next year.</dt>
<dd>
<ul>
<li>Suppose an LLM speeds you up by a factor <span class="math inline">\(\beta\)</span> on tasks that take up share <span class="math inline">\(s\)</span> of your work (pre-LLM), what’s the overall efficiency gain?</li>
<li>How does the answer change if you measure the time-share <span class="math inline">\(s\)</span>, <em>after</em> you adjust to use LLMs?</li>
<li>If we can observe the changes in both (1) per-task productivity impacts, and (2) per-task time-spent, can we back out the overall productivity impact?</li>
</ul>
</dd>
<dt>Estimating aggregate productivity increase is hard.</dt>
<dd>
<ol type="1">
<li><p><strong>The total output gain will be between <span class="math inline">\(\frac{1}{(1-s)+s/\beta}\)</span> (if perfect complements) and <span class="math inline">\(\beta\)</span> (if perfect substitutes).</strong> These numbers will only be similar only if the time-savings affect most tasks (<span class="math inline">\(s \simeq 1\)</span>), or the productivity effect is small (<span class="math inline">\(\beta\simeq 0\)</span>).</p></li>
<li><p><strong>If the time-savings are very small then Hulten’s theorem applies.</strong> If <span class="math inline">\(\beta\simeq0\)</span> then <span class="math inline">\(\Delta\ln y \approx s\ln\beta\)</span>, and time saved <span class="math inline">\(\approx \Delta\ln y\)</span>.</p></li>
<li><p><strong>If the time-savings are somewhat small then you can use elasticity of substitution.</strong> There’s a closed-form expression, given below.</p></li>
<li><p><strong>If the time-savings are large then you should use the entire area under the demand curve.</strong> If the time-savings are large then it’s no longer reasonable to assume a constant elasticity. However even the demand curve will not be perfect if there are significant income effects. In that case one might need to estimate a more flexible demand system, however I don’t have a good reference here.</p></li>
<li><p><strong>Using pre-LLM time-shares will under-estimate productivity improvements; using post-LLM time-shares will over-estimate productivity improvements.</strong> This holds strictly if using Amdahl’s law to estimate aggregate productivity improvements, which assumes zero substitability.</p></li>
<li><p><strong>We can estimate the aggregate productivity impact if we observe time allocation before and after the change.</strong> This holds at least for small changes (where we can assume constant elasticity of substitution). Graphically, if we observe the change in budget constraint, and chagne in consumption point, we can infer substitutability, and therefore aggregate productivity improvement.</p></li>
</ol>
</dd>
<dt>Applications to LLMs.</dt>
<dd>
<span class="citation" data-cites="anthropic2025estimatingproductivitygains">Anthropic (<a href="#ref-anthropic2025estimatingproductivitygains" role="doc-biblioref">2025</a>)</span> sample a range of tasks from Claude logs, and estimate the time-required with and without AI assistance. They estimate a typical speedup of 80%, but that AI is only used for around 25% of tasks, hence the total time-saving is around 20%. However Hulten’s theorem only applies for <em>small</em> efficiency changes, these are large changes (80%), so the conclusion requires assuming Cobb-Douglas substitution, i.e.&nbsp;that time-shares are constant.
</dd>
</dl>
<p><span class="citation" data-cites="becker2025uplift">Becker et al. (<a href="#ref-becker2025uplift" role="doc-biblioref">2025</a>)</span> estimate time-savings on tasks using LLMs. In this case the subjects mostly were <em>not</em> using AI, but in followup studies they <em>will</em> be using AI. This makes it hard to think about interpreting uplift studies over time, insofar as AI causes them to change the task distribution. It would be nice to have a good clear language here.</p>
<p><strong>Time savings using <em>ex-ante</em> time shares</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>10% saving on 50%</th>
<th>50% saving on 10%</th>
<th>80% saving on 10%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\varepsilon=0\)</span> (perfect complements/Amdahl)</td>
<td>5.0%</td>
<td>5.0%</td>
<td>8.0%</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\varepsilon=1/2\)</span> (complements)</td>
<td>5.1%</td>
<td>5.8%</td>
<td>10.7%</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\varepsilon=1\)</span> (Cobb-Douglas/Hulten)</td>
<td>5.1%</td>
<td>6.7%</td>
<td>14.9%</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\varepsilon\rightarrow\infty\)</span> (perfect substitutes)</td>
<td>10%</td>
<td>50%</td>
<td>80%</td>
</tr>
</tbody>
</table>
<p><strong>Time savings using <em>ex-post</em> time shares:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>10% saving on 50%</th>
<th>50% saving on 10%</th>
<th>80% saving on 10%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\varepsilon=0\)</span> (perfect complements/Amdahl)</td>
<td>5.3%</td>
<td>9.1%</td>
<td>28.6%</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\varepsilon=1/2\)</span> (complements)</td>
<td>5.2%</td>
<td>7.8%</td>
<td>20.8%</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\varepsilon=1\)</span> (Cobb-Douglas/Hulten)</td>
<td>5.1%</td>
<td>6.7%</td>
<td>14.9%</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\varepsilon\rightarrow\infty\)</span> (perfect substitutes)</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<dl>
<dt>How these are calculated:</dt>
<dd>
<ul>
<li><strong>“X% saving”</strong> means task-2 productivity increases so that time-per-unit falls by factor <span class="math inline">\((1-X)\)</span>, i.e., <span class="math inline">\(\beta = 1/(1-X)\)</span>. So 10% saving → <span class="math inline">\(\beta = 1.11\)</span>; 50% saving → <span class="math inline">\(\beta = 2\)</span>; 80% saving → <span class="math inline">\(\beta = 5\)</span>.
<ul>
<li><strong>“Y% of work”</strong> means the time share on task 2 is <span class="math inline">\(s = Y\)</span>.</li>
<li><strong>Output gain</strong> from the CES formula: <span class="math display">\[\frac{y'}{y} = \left((1-s_0) + s_0\,\beta^{\varepsilon-1}\right)^{1/(\varepsilon-1)}\]</span> where <span class="math inline">\(s_0\)</span> is the <em>ex-ante</em> share.</li>
<li><strong>Time savings</strong> = <span class="math inline">\(1 - (y'/y)^{-1}\)</span>, i.e., the fraction of time saved to produce the same output.</li>
<li><strong>Table 1:</strong> The column header specifies the ex-ante share <span class="math inline">\(s_0\)</span> directly. Compute the output gain and convert to time savings.</li>
<li><strong>Table 2:</strong> The column header specifies the ex-post share <span class="math inline">\(s_1\)</span>. First back out the implied ex-ante share using: <span class="math display">\[\frac{s_0}{1-s_0} = \frac{s_1}{1-s_1} \cdot \beta^{1-\varepsilon}\]</span> Then compute the true output gain using <span class="math inline">\(s_0\)</span>.</li>
<li><strong>Perfect substitutes (Table 2):</strong> After any productivity improvement, you reallocate entirely to the better task, so the ex-post share is always 100%. Specifying it as 10% or 50% is inconsistent with optimization—hence N/A.</li>
</ul></li>
</ul>
</dd>
<dt>An analogy: if we can turn lead into gold, what benefit do I get?</dt>
<dd>
<p>Using ex ante expenditure: my expenditure share on gold is ~0%, so my benefit is very small.</p>
<p>Using ex post expenditure: if gold is cheap then I’ll start buying gold cutlery. Suppose I spend $1K on gold/year, then it makes it look like I’m getting value worth $100K/year, which is clearly wrong.</p>
<p>I think the resolution is that gold has high substitutability with other goods (steel, bronze), and so demand is highly elastic. But that substitutability only appears when prices are low, so just estimating a CES function I think would get this wrong.</p>
</dd>
<dt>There are some nice crisp results from economics that apply here.</dt>
<dd>
I discuss some related literature below.
</dd>
<dt>Loose ends:</dt>
<dd>
<ul>
<li>I give bounds on aggregate time-savings with a CES model below, but I’m not sure whether you might not get wider bounds if you relax the CES assumption, e.g.&nbsp;with non-homotheticities so there are income effects.</li>
</ul>
</dd>
</dl>
</section>
<section id="model" class="level1">
<h1>Model</h1>
<p>We set up a two-task CES production problem and derive the optimal time split, the implied output, and the response to productivity changes, with limits for common special cases.</p>
<p><strong>Practical implications (at a glance)</strong></p>
<p>Let <span class="math inline">\(s\equiv t_2^*\)</span> denote the optimal time share on task 2 (and <span class="math inline">\(1-s=t_1^*\)</span>). Express all effects as log-changes <span class="math inline">\(\Delta\ln y^*=\ln\!\big(y^{*'}/y^*\big)\)</span> when task-2 productivity moves from <span class="math inline">\(A_2\)</span> to <span class="math inline">\(A_2'=\beta A_2\)</span>. The last column plugs in <span class="math inline">\(s=0.1\)</span> and <span class="math inline">\(\beta=2\)</span>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 33%">
<col style="width: 21%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Case</th>
<th>Output effect (<span class="math inline">\(\Delta\ln y^*\)</span>)</th>
<th>Intuition</th>
<th>Example <span class="math inline">\(\Delta\ln y^*\)</span> (<span class="math inline">\(s=0.1,\ \beta=2\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>General finite change</td>
<td><span class="math inline">\(\dfrac{1}{\varepsilon-1}\ln\!\big((1-s)+s\,\beta^{\varepsilon-1}\big)\)</span></td>
<td>CES-weighted average of the shock</td>
<td><span class="math inline">\(\dfrac{1}{\varepsilon-1}\ln\!\big(0.9+0.1\times2^{\varepsilon-1}\big)\)</span> (depends on <span class="math inline">\(\varepsilon\)</span>)</td>
</tr>
<tr class="even">
<td>Perfect substitutes (<span class="math inline">\(\varepsilon\rightarrow\infty\)</span>)</td>
<td><span class="math inline">\(\ln \beta\)</span></td>
<td>All time moves to the better task</td>
<td><span class="math inline">\(\approx 0.69\)</span></td>
</tr>
<tr class="odd">
<td>Cobb–Douglas (<span class="math inline">\(\varepsilon=1\)</span>)</td>
<td><span class="math inline">\(s\,\ln \beta\)</span></td>
<td>Log-linear weighting by the task share</td>
<td><span class="math inline">\(\approx 0.069\)</span></td>
</tr>
<tr class="even">
<td>Perfect complements (<span class="math inline">\(\varepsilon\rightarrow0\)</span>)</td>
<td><span class="math inline">\(-\ln\!\big((1-s)+s/\beta\big)\)</span></td>
<td>Bottlenecked by the slow task</td>
<td><span class="math inline">\(\approx 0.051\)</span></td>
</tr>
<tr class="odd">
<td>Infinitesimal change (Hulten)</td>
<td><span class="math inline">\(s\,d\ln A_2\)</span></td>
<td>Percent gain equals time share on improved task</td>
<td><span class="math inline">\(0.1\times\ln 2\approx 0.069\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Setup and parameters</strong></p>
<ul>
<li>Time endowment is <span class="math inline">\(1\)</span>; choose <span class="math inline">\(t_1\in[0,1]\)</span> and <span class="math inline">\(t_2=1-t_1\)</span>.</li>
<li>Productivities: <span class="math inline">\(A_1&gt;0\)</span> for task <span class="math inline">\(1\)</span>, <span class="math inline">\(A_2&gt;0\)</span> for task <span class="math inline">\(2\)</span>.</li>
<li>Taste weight: <span class="math inline">\(\alpha\in(0,1)\)</span> on task <span class="math inline">\(1\)</span>.</li>
<li>Substitution parameter: <span class="math inline">\(\varepsilon&gt;0\)</span>; take <span class="math inline">\(\varepsilon\neq1\)</span> for the algebra and then send <span class="math inline">\(\varepsilon\rightarrow1\)</span> for the Cobb–Douglas limit.</li>
<li>Output aggregator (CES): <span class="math display">\[y(t_1,t_2)=\left(\alpha(A_1 t_1)^{\frac{\varepsilon-1}{\varepsilon}}+(1-\alpha)(A_2 t_2)^{\frac{\varepsilon-1}{\varepsilon}}\right)^{\frac{\varepsilon}{\varepsilon-1}}.\]</span></li>
</ul>
<p><strong>Assumptions</strong></p>
<ol type="1">
<li>Feasible set: <span class="math inline">\(t_1\in[0,1]\)</span>, <span class="math inline">\(t_2=1-t_1\)</span>.</li>
<li>Parameters satisfy <span class="math inline">\(A_i&gt;0\)</span> and <span class="math inline">\(\alpha\in(0,1)\)</span>.</li>
<li>Decision problem: choose <span class="math inline">\(t_1\)</span> to maximise <span class="math inline">\(y(t_1,1-t_1)\)</span>.</li>
</ol>
<p><strong>Proposition 1 (optimal time split).</strong> The interior optimum is <span class="math display">\[t_1^*=\frac{1}{1+\left(\frac{1-\alpha}{\alpha}\right)^{\varepsilon}\left(\frac{A_2}{A_1}\right)^{\varepsilon-1}},\qquad t_2^*=1-t_1^*.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Write the Lagrangian <span class="math inline">\(\mathcal{L}=y(t_1,t_2)+\lambda(1-t_1-t_2)\)</span> with <span class="math inline">\(y\)</span> as above.</li>
<li>First-order conditions (interior): <span class="math inline">\(\partial\mathcal{L}/\partial t_1=0\)</span> and <span class="math inline">\(\partial\mathcal{L}/\partial t_2=0\)</span> give <span class="math display">\[\lambda=\alpha\,A_1^{\frac{\varepsilon-1}{\varepsilon}}\,t_1^{-\frac{1}{\varepsilon}}\,y^{\frac{1}{\varepsilon}}=(1-\alpha)\,A_2^{\frac{\varepsilon-1}{\varepsilon}}\,t_2^{-\frac{1}{\varepsilon}}\,y^{\frac{1}{\varepsilon}}.\]</span></li>
<li>Cancel <span class="math inline">\(y^{\frac{1}{\varepsilon}}\)</span> and rearrange to obtain <span class="math inline">\(\frac{t_2}{t_1}=\left(\frac{1-\alpha}{\alpha}\right)^{\varepsilon}\left(\frac{A_2}{A_1}\right)^{\varepsilon-1}\)</span>.</li>
<li>Impose <span class="math inline">\(t_1+t_2=1\)</span> and solve for <span class="math inline">\(t_1^*\)</span>; set <span class="math inline">\(t_2^*=1-t_1^*\)</span>.</li>
<li>The interior solution is valid for <span class="math inline">\(\varepsilon&gt;0\)</span> with finite <span class="math inline">\(A_i\)</span>; only the perfect-substitutes limit <span class="math inline">\(\varepsilon\rightarrow\infty\)</span> or <span class="math inline">\(A_i\rightarrow0\)</span> forces a corner.</li>
</ol>
<p><strong>Proposition 2 (indirect output).</strong> At <span class="math inline">\(t_1^*,t_2^*\)</span> the output is <span class="math display">\[y^*=\Big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\Big)^{\frac{1}{\varepsilon-1}}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Substitute <span class="math inline">\(t_1^*,t_2^*\)</span> from Proposition 1 into <span class="math inline">\(y(t_1,t_2)\)</span>.</li>
<li>Factor out <span class="math inline">\(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\)</span> inside the braces; the exponent <span class="math inline">\(\frac{\varepsilon}{\varepsilon-1}\)</span> collapses to the stated form.</li>
</ol>
<p><strong>Proposition 3 (infinitesimal productivity change).</strong> Holding <span class="math inline">\(A_1\)</span> fixed, a small change in <span class="math inline">\(A_2\)</span> satisfies <span class="math display">\[\frac{dy^*}{y^*}=t_2^*\,\frac{dA_2}{A_2}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Take <span class="math inline">\(\log y^*=\frac{1}{\varepsilon-1}\log\big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}\big)\)</span>.</li>
<li>Differentiate with respect to <span class="math inline">\(\log A_2\)</span>: <span class="math display">\[\frac{dy^*}{y^*}=\frac{(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}}{\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}A_2^{\varepsilon-1}}\cdot\frac{dA_2}{A_2}.\]</span></li>
<li>The fraction equals <span class="math inline">\(t_2^*\)</span> from Proposition 1, so the result follows.</li>
</ol>
<p><strong>Proposition 4 (finite productivity change on task 2).</strong> If <span class="math inline">\(A_2'=\beta A_2\)</span> with <span class="math inline">\(\beta&gt;0\)</span>, then <span class="math display">\[\frac{y^{*'}}{y^*}=\left(t_1^*+(1-t_1^*)\beta^{\varepsilon-1}\right)^{\frac{1}{\varepsilon-1}}.\]</span></p>
<p><em>Proof (explicit)</em></p>
<ol type="1">
<li>Replace <span class="math inline">\(A_2\)</span> by <span class="math inline">\(\beta A_2\)</span> in <span class="math inline">\(y^*\)</span> from Proposition 2: <span class="math display">\[y^{*'}=\Big(\alpha^{\varepsilon}A_1^{\varepsilon-1}+(1-\alpha)^{\varepsilon}(\beta A_2)^{\varepsilon-1}\Big)^{\frac{1}{\varepsilon-1}}.\]</span></li>
<li>Factor out the old level <span class="math inline">\(y^*\)</span> to form a ratio; the remaining weights inside the braces are <span class="math inline">\(t_1^*\)</span> and <span class="math inline">\(t_2^*=1-t_1^*\)</span>, giving the stated expression.</li>
</ol>
<p><strong>Proposition 5 (canonical limits).</strong> Take limits of Proposition 4:</p>
<ul>
<li>Cobb–Douglas (<span class="math inline">\(\varepsilon\rightarrow1\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \beta^{1-\alpha}\)</span> and <span class="math inline">\(t_i^*\)</span> is unchanged.</li>
<li>Perfect complements (<span class="math inline">\(\varepsilon\rightarrow0\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \frac{1}{t_1^*+t_2^*/\beta}\)</span>.</li>
<li>Perfect substitutes (<span class="math inline">\(\varepsilon\rightarrow\infty\)</span>): <span class="math inline">\(\frac{y^{*'}}{y^*}\rightarrow \beta\)</span> with <span class="math inline">\(t_2^*\rightarrow1\)</span> if <span class="math inline">\(\beta A_2&gt;A_1\)</span>.</li>
</ul>
<p><em>Proof sketch</em> For <span class="math inline">\(\varepsilon\rightarrow1\)</span> apply L’Hôpital to the CES form. For <span class="math inline">\(\varepsilon\rightarrow0\)</span> the CES aggregator converges to <span class="math inline">\(\min\{A_1 t_1,A_2 t_2\}\)</span>. For <span class="math inline">\(\varepsilon\rightarrow\infty\)</span> it converges to <span class="math inline">\(\max\{A_1 t_1,A_2 t_2\}\)</span>. Substitute these limits into Proposition 4 and simplify.</p>
</section>
<section id="related-theory" class="level1">
<h1>Related Theory</h1>
<dl>
<dt>The index numbers problem.</dt>
<dd>
<span class="citation" data-cites="caves1982indexnumbers">Caves, Christensen, and Diewert (<a href="#ref-caves1982indexnumbers" role="doc-biblioref">1982</a>)</span> formalize why productivity (or “quantity”) measurement becomes an index-number problem as soon as <em>shares move endogenously</em>:
</dd>
<dd>
<ul>
<li>A Laspeyres-style measure (base-period weights) is biased toward <em>understating</em> gains when a shock makes you reallocate toward the improved input/task, because it freezes the old bundle.</li>
</ul>
</dd>
<dd>
<ul>
<li>A Paasche-style measure (end-period weights) is biased toward <em>overstating</em> gains if you implicitly treat the new bundle as if it had always been purchased at the old relative prices/technologies.</li>
</ul>
</dd>
<dd>
<ul>
<li>The object you actually want is a path (Divisia) integral of share-weighted growth rates; “superlative” discrete indices (e.g., Fisher/Törnqvist) are designed to approximate that integral well.</li>
</ul>
</dd>
<dt>Consumer surplus / welfare for large “price” (time-cost) changes</dt>
<dd>
<span class="citation" data-cites="willig1976consumerssurplus">Willig (<a href="#ref-willig1976consumerssurplus" role="doc-biblioref">1976</a>)</span> defends using Marshallian consumer surplus as a welfare proxy: the area under the (Marshallian) demand curve is close to the Hicksian objects (EV/CV) when income effects are small, and Willig provides conditions/bounds under which the approximation error is limited.
</dd>
<dd>
<span class="citation" data-cites="hausman1981exact">Hausman (<a href="#ref-hausman1981exact" role="doc-biblioref">1981</a>)</span> shows how to compute exact welfare measures (EV/CV, deadweight loss) from an estimated demand curve by imposing integrability (i.e., that the demand actually comes from some underlying utility/expenditure function).
</dd>
<dd>
<span class="citation" data-cites="deaton1980aids">Deaton and Muellbauer (<a href="#ref-deaton1980aids" role="doc-biblioref">1980</a>)</span> provides a workhorse <em>integrable</em> demand system (AIDS) that flexibly captures income effects and substitution patterns while keeping welfare calculations coherent.
</dd>
<dd>
In our model you can interpert the task outputs as the goods, and productivities are inverse prices. An LLM that raises <span class="math inline">\(A_2\)</span> by <span class="math inline">\(\beta\)</span> is literally a price drop for good 2 by a factor <span class="math inline">\(1/\beta\)</span>. For small task shares (<span class="math inline">\(s=t_2^*\)</span>), the Willig logic says income effects are small, so the demand curve is OK. When the effective budget share is not small, or when the shock is large, then you want an <em>integrable system</em>.
</dd>
<dt>Economics of time allocation (time is a scarce input with shadow prices)</dt>
<dd>
<span class="citation" data-cites="deserpa1971time">DeSerpa (<a href="#ref-deserpa1971time" role="doc-biblioref">1971</a>)</span> is a classic reference on time allocation, and time-saving innovations as relaxing the budget constraint.
</dd>
<dt>Task substitution and computerization as task-specific technology shocks</dt>
<dd>
<span class="citation" data-cites="autor2003skill">Autor, Levy, and Murnane (<a href="#ref-autor2003skill" role="doc-biblioref">2003</a>)</span> gives the modern “tasks” approach: computerization substitutes for routine tasks and complements non-routine tasks, shifting task content within occupations and generating distributional consequences (e.g., polarization). You cannot summarize tech change as “labor-augmenting” in the aggregate.
</dd>
<dd>
<span class="citation" data-cites="acemoglu2011handbook">Acemoglu and Autor (<a href="#ref-acemoglu2011handbook" role="doc-biblioref">2011</a>)</span> synthesizes and formalizes this task-based view. A central message is that the impact of a task-specific productivity shock depends on: (i) which tasks are affected, (ii) how substitutable tasks are, and (iii) how the economy re-optimizes task assignment across workers/technologies.
</dd>
<dt>Hulten’s theorem and when first-order share-weighting breaks</dt>
<dd>
<span class="citation" data-cites="hulten1978growth">Hulten (<a href="#ref-hulten1978growth" role="doc-biblioref">1978</a>)</span> shows (in a competitive, CRS setting with intermediates) that a <em>small</em> productivity shock’s effect on aggregate productivity can be summarized by share-weighted sectoral TFP growth (Domar/revenue-share weights). The key takeaway is the legitimacy of first-order share weighting—but only locally.
</dd>
<dd>
<span class="citation" data-cites="baqaee2019macro">Baqaee and Farhi (<a href="#ref-baqaee2019macro" role="doc-biblioref">2019</a>)</span> shows that in production networks, micro shocks can have macro consequences and nonlinearities/higher-order terms matter.
</dd>
<dd>
<span class="citation" data-cites="baqaeeBurstein2021incomeeffects">Baqaee and Burstein (<a href="#ref-baqaeeBurstein2021incomeeffects" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="cominLashkariMestieri2021structuralchange">Comin, Lashkari, and Mestieri (<a href="#ref-cominLashkariMestieri2021structuralchange" role="doc-biblioref">2021</a>)</span> take into account income effects.
</dd>
<dt>Amdahl’s law as the perfect-complements benchmark</dt>
<dd>
Amdahl’s law in computer science says the speedup from improving one component is bounded by the unimproved fraction. This corresponds to the perfect-complements case.
</dd>
</dl>
</section>
<section id="illustrations" class="level1">
<h1>Illustrations</h1>
<section id="indifference-curve" class="level2">
<h2 class="anchored" data-anchor-id="indifference-curve">Indifference Curve</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Budget constraint and optimal allocations under different elasticities</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="demand-curve" class="level2">
<h2 class="anchored" data-anchor-id="demand-curve">Demand Curve</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2025-12-17-llm-time-saving-demand-theory-substitution_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Demand curves with different price elasticities</figcaption>
</figure>
</div>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-acemoglu2011handbook" class="csl-entry" role="listitem">
Acemoglu, Daron, and David Autor. 2011. <span>“Skills, Tasks and Technologies: Implications for Employment and Earnings.”</span> In, edited by David Card and Orley Ashenfelter, 4:1043–1171. Handbook of Labor Economics. Elsevier. https://doi.org/<a href="https://doi.org/10.1016/S0169-7218(11)02410-5">https://doi.org/10.1016/S0169-7218(11)02410-5</a>.
</div>
<div id="ref-anthropic2025estimatingproductivitygains" class="csl-entry" role="listitem">
Anthropic. 2025. <span>“Estimating AI Productivity Gains from Claude Conversations.”</span> 2025. <a href="https://www.anthropic.com/research/estimating-productivity-gains">https://www.anthropic.com/research/estimating-productivity-gains</a>.
</div>
<div id="ref-autor2003skill" class="csl-entry" role="listitem">
Autor, David, Frank Levy, and Richard J Murnane. 2003. <span>“The Skill Content of Recent Technological Change: An Empirical Exploration.”</span> <em>The Quarterly Journal of Economics</em> 118 (4): 1279–1333. <a href="https://doi.org/10.3386/w8337">https://doi.org/10.3386/w8337</a>.
</div>
<div id="ref-baqaeeBurstein2021incomeeffects" class="csl-entry" role="listitem">
Baqaee, David Rezza, and Ariel Burstein. 2021. <span>“Welfare and Output with Income Effects and Demand Instability.”</span> Working Paper. <a href="https://www.semanticscholar.org/search?q=Welfare%20and%20Output%20with%20Income%20Effects%20and%20Demand%20Instability">https://www.semanticscholar.org/search?q=Welfare%20and%20Output%20with%20Income%20Effects%20and%20Demand%20Instability</a>.
</div>
<div id="ref-baqaee2019macro" class="csl-entry" role="listitem">
Baqaee, David Rezza, and Emmanuel Farhi. 2019. <span>“The Macroeconomic Impact of Microeconomic Shocks: Beyond Hulten’s Theorem.”</span> <em>Econometrica</em> 87 (4): 1155–1206. <a href="https://doi.org/10.3982/ecta15202">https://doi.org/10.3982/ecta15202</a>.
</div>
<div id="ref-becker2025uplift" class="csl-entry" role="listitem">
Becker, Joel, Nate Rush, Elizabeth Barnes, and David Rein. 2025. <span>“Measuring the Impact of Early-2025 AI on Experienced Open-Source Developer Productivity.”</span> <a href="https://arxiv.org/pdf/2507.09089.pdf">https://arxiv.org/pdf/2507.09089.pdf</a>.
</div>
<div id="ref-caves1982indexnumbers" class="csl-entry" role="listitem">
Caves, Douglas W., Laurits R. Christensen, and W. Erwin Diewert. 1982. <span>“The Economic Theory of Index Numbers and the Measurement of Input, Output, and Productivity.”</span> <em>Econometrica</em> 50 (6): 1393–1414. <a href="https://www.jstor.org/stable/1913382">https://www.jstor.org/stable/1913382</a>.
</div>
<div id="ref-cominLashkariMestieri2021structuralchange" class="csl-entry" role="listitem">
Comin, Diego, Danial Lashkari, and Martı́n Mestieri. 2021. <span>“Structural Change with Long-Run Income and Price Effects.”</span> Working Paper. <a href="https://doi.org/10.3982/ecta16317">https://doi.org/10.3982/ecta16317</a>.
</div>
<div id="ref-deaton1980aids" class="csl-entry" role="listitem">
Deaton, Angus, and John Muellbauer. 1980. <span>“An Almost Ideal Demand System.”</span> <em>American Economic Review</em> 70 (3): 312–26. <a href="https://www.semanticscholar.org/search?q=An%20Almost%20Ideal%20Demand%20System">https://www.semanticscholar.org/search?q=An%20Almost%20Ideal%20Demand%20System</a>.
</div>
<div id="ref-deserpa1971time" class="csl-entry" role="listitem">
DeSerpa, Allan C. 1971. <span>“A Theory of the Economics of Time.”</span> <em>The Economic Journal</em> 81 (324): 828–46. <a href="https://doi.org/10.2307/2230320">https://doi.org/10.2307/2230320</a>.
</div>
<div id="ref-hausman1981exact" class="csl-entry" role="listitem">
Hausman, Jerry A. 1981. <span>“Exact Consumer’s Surplus and Deadweight Loss.”</span> <em>American Economic Review</em> 71 (4): 662–76. <a href="https://www.semanticscholar.org/search?q=Exact%20Consumer%27s%20Surplus%20and%20Deadweight%20Loss">https://www.semanticscholar.org/search?q=Exact%20Consumer%27s%20Surplus%20and%20Deadweight%20Loss</a>.
</div>
<div id="ref-hulten1978growth" class="csl-entry" role="listitem">
Hulten, Charles R. 1978. <span>“Growth Accounting with Intermediate Inputs.”</span> <em>The Review of Economic Studies</em> 45 (3): 511–18. <a href="https://doi.org/10.2307/2297252">https://doi.org/10.2307/2297252</a>.
</div>
<div id="ref-willig1976consumerssurplus" class="csl-entry" role="listitem">
Willig, Robert D. 1976. <span>“Consumer’s Surplus Without Apology.”</span> <em>American Economic Review</em> 66 (4): 589–97. <a href="https://www.semanticscholar.org/paper/745fa39279d59c6f6b14dce4a38bcf098774c2ad">https://www.semanticscholar.org/paper/745fa39279d59c6f6b14dce4a38bcf098774c2ad</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("tecunningham\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>